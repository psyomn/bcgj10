var using=function(){"use strict";function e(n){var r,o=[],u=c[n],h=p[n];a[n]||(0===u.length?(r=l[n](),r||console.error("Module '"+n+"' returned nothing"),a[n]=r,d[n].forEach(e)):i(u)&&(u.forEach(function(e,t){o.push(s(e,h[t]))}),r=l[n].apply(void 0,o),r||console.error("Module '"+n+"' returned nothing."),a[n]=r,d[n].forEach(e)),t())}function t(){f||(f=!0,n())}function n(){h.forEach(function(e){e()}),h.length?setTimeout(n,20):f=!1}function i(e){var t=!0;return e.forEach(function(e){a[e]||(t=!1)}),t}function s(e,t){var n,i;if(i=a[e],!t)return console.log("Module has no selectors:",e),i;for(n=t.slice();n.length;){if("object"!=typeof i||null===i)throw new TypeError("Module '"+e+"' has no property '"+n.join("::")+"'.");i=i[n.shift()]}return i}function r(){function n(e){function n(t){var r=[];return i(m)?(m.forEach(function(e,t){r.push(s(e,g[t]))}),e.apply(void 0,r),t||h.splice(h.indexOf(n),1),!0):!1}return n(!0)||h.push(n),t(),y}function u(t,n){if(t in l)throw new Error("Module '"+t+"' is already defined.");return l[t]=n,c[t]=m,p[t]=g,d[t]||(d[t]=[]),m.forEach(function(e){d[e]||(d[e]=[]),d[e].push(t)}),e(t),y}var f,m,g,y;return m=[],g=[],f=[].slice.call(arguments),f.forEach(function(t,n){function i(n){a[t]=n,d[t].forEach(e)}var s,u,l=t.split("::"),h=l[0].split(":"),p=h.length>1?h[0]:"";l[0]=h.length>1?h[1]:h[0],s=l.slice(1),u=l[0],"ajax"===p?m.push(t):m.push(u),g.push(s),u in c||u in a||("ajax"===p?(c[t]=[],d[t]||(d[t]=[]),r.ajax(r.ajax.HTTP_METHOD_GET,t.replace(/^ajax:/,""),null,i,i)):(c[u]=[],d[u]||(d[u]=[]),o(u)))}),y={run:n,define:u}}function o(e){if(!(e in r.modules))throw new Error("Unknown module '"+e+"'.");r.loadScript(r.modules[e])}var a={},u={},c={},l={},d={},h=[],p={},f=!1;return r.path="",function(){var e=document.getElementsByTagName("script");r.path=e[e.length-1].src.replace(/using\.js$/,"")}(),r.modules={},r.loadScript=function(e){var t=document.createElement("script"),n="using_script_"+e;u[e]||document.getElementById(n)||(t.setAttribute("id",n),t.src=e,document.body.appendChild(t))},r}();using.ajax=function(){function e(e,n,i,s,r,a){var u=XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");return u.open(e,n+"?random="+Math.random(),!0),a&&(u.timeout=a,u.ontimeout=function(){u.abort(),r&&r(new Error("Connection has reached the timeout of "+a+" ms."))}),u.onreadystatechange=function(){var e,n;if(e=u.readyState===o){try{n=u.status===t}catch(i){console.error(i),n=!1}n?s(u):r(u)}},i?u.send(i):u.send(),u}var t=200,n=0,i=1,s=2,r=3,o=4;return e.HTTP_STATUS_OK=t,e.READY_STATE_UNSENT=n,e.READY_STATE_OPENED=i,e.READY_STATE_HEADERS_RECEIVED=s,e.READY_STATE_LOADING=r,e.READY_STATE_DONE=o,e.HTTP_METHOD_GET="GET",e.HTTP_METHOD_POST="POST",e.HTTP_METHOD_PUT="PUT",e.HTTP_METHOD_DELETE="DELETE",e.HTTP_METHOD_HEAD="HEAD",e}(),"undefined"!=typeof window&&(window.requestAnimationFrame=function(){"use strict";return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}()),function(){Array.prototype.forEach||(Array.prototype.forEach=function(e){for(var t=0,n=this.length;n>t;t+=1)e(this[t],t,this)})}(),function(){Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var n;if(null==this)throw new TypeError('"this" is null or not defined');var i=Object(this),s=i.length>>>0;if(0===s)return-1;var r=+t||0;if(Math.abs(r)===1/0&&(r=0),r>=s)return-1;for(n=Math.max(r>=0?r:s-Math.abs(r),0);s>n;){if(n in i&&i[n]===e)return n;n++}return-1})}(),"undefined"==typeof console&&(this.console={}),console.log||(console.log=function(){}),console.dir||(console.dir=console.log),console.error||(console.error=console.log),console.warn||(console.warn=console.log),function(){var e=document.getElementsByTagName("script"),t=e[e.length-1].src.replace(/MO5\.js$/,"");using.modules={"MO5.ajax":t+"ajax.js","MO5.assert":t+"assert.js","MO5.Exception":t+"Exception.js","MO5.fail":t+"fail.js","MO5.EventBus":t+"EventBus.js","MO5.CoreObject":t+"CoreObject.js","MO5.List":t+"List.js","MO5.Queue":t+"Queue.js","MO5.Map":t+"Map.js","MO5.Set":t+"Set.js","MO5.Result":t+"Result.js","MO5.Promise":t+"Promise.js","MO5.Timer":t+"Timer.js","MO5.TimerWatcher":t+"TimerWatcher.js","MO5.easing":t+"easing.js","MO5.transform":t+"transform.js","MO5.range":t+"range.js","MO5.tools":t+"tools.js","MO5.Point":t+"Point.js","MO5.Size":t+"Size.js","MO5.Animation":t+"Animation.js","MO5.dom.effects.typewriter":t+"dom.effects.typewriter.js","MO5.dom.Element":t+"dom.Element.js","MO5.dom.escape":t+"dom.escape.js","MO5.globals.document":t+"globals.document.js","MO5.globals.window":t+"globals.window.js","MO5.types":t+"types.js"}}();var $__WSEScripts=document.getElementsByTagName("script");WSEPath=$__WSEScripts[$__WSEScripts.length-1].src,using.modules.howler=WSEPath,using.modules["MO5.ajax"]=WSEPath,using.modules["MO5.Animation"]=WSEPath,using.modules["MO5.assert"]=WSEPath,using.modules["MO5.CoreObject"]=WSEPath,using.modules["MO5.dom.effects.typewriter"]=WSEPath,using.modules["MO5.dom.Element"]=WSEPath,using.modules["MO5.dom.escape"]=WSEPath,using.modules["MO5.easing"]=WSEPath,using.modules["MO5.EventBus"]=WSEPath,using.modules["MO5.Exception"]=WSEPath,using.modules["MO5.fail"]=WSEPath,using.modules["MO5.globals.document"]=WSEPath,using.modules["MO5.globals.window"]=WSEPath,using.modules["MO5.List"]=WSEPath,using.modules["MO5.Map"]=WSEPath,using.modules["MO5.Point"]=WSEPath,using.modules["MO5.Promise"]=WSEPath,using.modules["MO5.Queue"]=WSEPath,using.modules["MO5.range"]=WSEPath,using.modules["MO5.Result"]=WSEPath,using.modules["MO5.Set"]=WSEPath,using.modules["MO5.Size"]=WSEPath,using.modules["MO5.Timer"]=WSEPath,using.modules["MO5.TimerWatcher"]=WSEPath,using.modules["MO5.tools"]=WSEPath,using.modules["MO5.transform"]=WSEPath,using.modules["MO5.types"]=WSEPath,using.modules["WSE.assets"]=WSEPath,using.modules["WSE.commands"]=WSEPath,using.modules["WSE.functions"]=WSEPath,using.modules["WSE.dataSources"]=WSEPath,using.modules.WSE=WSEPath,using.modules["WSE.Keys"]=WSEPath,using.modules["WSE.tools"]=WSEPath,using.modules["WSE.dataSources.LocalStorage"]=WSEPath,using.modules["WSE.Trigger"]=WSEPath,using.modules["WSE.Game"]=WSEPath,using.modules["WSE.Interpreter"]=WSEPath,using.modules["WSE.LoadingScreen"]=WSEPath,using.modules["WSE.tools.ui"]=WSEPath,using.modules["WSE.DisplayObject"]=WSEPath,using.modules["WSE.assets.Animation"]=WSEPath,using.modules["WSE.assets.Audio"]=WSEPath,using.modules["WSE.assets.Character"]=WSEPath,using.modules["WSE.assets.Curtain"]=WSEPath,using.modules["WSE.assets.Imagepack"]=WSEPath,using.modules["WSE.assets.Textbox"]=WSEPath,using.modules["WSE.assets.Background"]=WSEPath,using.modules["WSE.commands.alert"]=WSEPath,using.modules["WSE.commands.break"]=WSEPath,using.modules["WSE.commands.choice"]=WSEPath,using.modules["WSE.commands.confirm"]=WSEPath,using.modules["WSE.commands.do"]=WSEPath,using.modules["WSE.commands.fn"]=WSEPath,using.modules["WSE.commands.global"]=WSEPath,using.modules["WSE.commands.globalize"]=WSEPath,using.modules["WSE.commands.goto"]=WSEPath,using.modules["WSE.commands.line"]=WSEPath,using.modules["WSE.commands.localize"]=WSEPath,using.modules["WSE.commands.prompt"]=WSEPath,using.modules["WSE.commands.restart"]=WSEPath,using.modules["WSE.commands.sub"]=WSEPath,using.modules["WSE.commands.trigger"]=WSEPath,using.modules["WSE.commands.var"]=WSEPath,using.modules["WSE.commands.set_vars"]=WSEPath,using.modules["WSE.commands.wait"]=WSEPath,using.modules["WSE.commands.with"]=WSEPath,using.modules["WSE.commands.while"]=WSEPath,function(){var e={},t=null,n=!0,i=!1;try{"undefined"!=typeof AudioContext?t=new AudioContext:"undefined"!=typeof webkitAudioContext?t=new webkitAudioContext:n=!1}catch(s){n=!1}if(!n)if("undefined"!=typeof Audio)try{new Audio}catch(s){i=!0}else i=!0;if(n){var r="undefined"==typeof t.createGain?t.createGainNode():t.createGain();r.gain.value=1,r.connect(t.destination)}var o=function(e){this._volume=1,this._muted=!1,this.usingWebAudio=n,this.ctx=t,this.noAudio=i,this._howls=[],this._codecs=e,this.iOSAutoEnable=!0};o.prototype={volume:function(e){var t=this;if(e=parseFloat(e),e>=0&&1>=e){t._volume=e,n&&(r.gain.value=e);for(var i in t._howls)if(t._howls.hasOwnProperty(i)&&t._howls[i]._webAudio===!1)for(var s=0;s<t._howls[i]._audioNode.length;s++)t._howls[i]._audioNode[s].volume=t._howls[i]._volume*t._volume;return t}return n?r.gain.value:t._volume},mute:function(){return this._setMuted(!0),this},unmute:function(){return this._setMuted(!1),this},_setMuted:function(e){var t=this;t._muted=e,n&&(r.gain.value=e?0:t._volume);for(var i in t._howls)if(t._howls.hasOwnProperty(i)&&t._howls[i]._webAudio===!1)for(var s=0;s<t._howls[i]._audioNode.length;s++)t._howls[i]._audioNode[s].muted=e},codecs:function(e){return this._codecs[e]},_enableiOSAudio:function(){var e=this;if(!t||!e._iOSEnabled&&/iPhone|iPad|iPod/i.test(navigator.userAgent)){e._iOSEnabled=!1;var n=function(){var i=t.createBuffer(1,1,22050),s=t.createBufferSource();s.buffer=i,s.connect(t.destination),"undefined"==typeof s.start?s.noteOn(0):s.start(0),setTimeout(function(){(s.playbackState===s.PLAYING_STATE||s.playbackState===s.FINISHED_STATE)&&(e._iOSEnabled=!0,e.iOSAutoEnable=!1,window.removeEventListener("touchstart",n,!1))},0)};return window.addEventListener("touchstart",n,!1),e}}};var a=null,u={};i||(a=new Audio,u={mp3:!!a.canPlayType("audio/mpeg;").replace(/^no$/,""),opus:!!a.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!a.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),aac:!!a.canPlayType("audio/aac;").replace(/^no$/,""),m4a:!!(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/m4a;")||a.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(a.canPlayType("audio/x-mp4;")||a.canPlayType("audio/mp4;")||a.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!a.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")});var c=new o(u),l=function(e){var i=this;i._autoplay=e.autoplay||!1,i._buffer=e.buffer||!1,i._duration=e.duration||0,i._format=e.format||null,i._loop=e.loop||!1,i._loaded=!1,i._sprite=e.sprite||{},i._src=e.src||"",i._pos3d=e.pos3d||[0,0,-.5],i._volume=void 0!==e.volume?e.volume:1,i._urls=e.urls||[],i._rate=e.rate||1,i._model=e.model||null,i._onload=[e.onload||function(){}],i._onloaderror=[e.onloaderror||function(){}],i._onend=[e.onend||function(){}],i._onpause=[e.onpause||function(){}],i._onplay=[e.onplay||function(){}],i._onendTimer=[],i._webAudio=n&&!i._buffer,i._audioNode=[],i._webAudio&&i._setupAudioNode(),"undefined"!=typeof t&&t&&c.iOSAutoEnable&&c._enableiOSAudio(),c._howls.push(i),i.load()};if(l.prototype={load:function(){var e=this,t=null;if(i)return void e.on("loaderror");for(var n=0;n<e._urls.length;n++){var s,r;if(e._format)s=e._format;else{if(r=e._urls[n],s=/^data:audio\/([^;,]+);/i.exec(r),s||(s=/\.([^.]+)$/.exec(r.split("?",1)[0])),!s)return void e.on("loaderror");s=s[1].toLowerCase()}if(u[s]){t=e._urls[n];break}}if(!t)return void e.on("loaderror");if(e._src=t,e._webAudio)d(e,t);else{var a=new Audio;a.addEventListener("error",function(){a.error&&4===a.error.code&&(o.noAudio=!0),e.on("loaderror",{type:a.error?a.error.code:0})},!1),e._audioNode.push(a),a.src=t,a._pos=0,a.preload="auto",a.volume=c._muted?0:e._volume*c.volume();var l=function(){e._duration=Math.ceil(10*a.duration)/10,0===Object.getOwnPropertyNames(e._sprite).length&&(e._sprite={_default:[0,1e3*e._duration]}),e._loaded||(e._loaded=!0,e.on("load")),e._autoplay&&e.play(),a.removeEventListener("canplaythrough",l,!1)};a.addEventListener("canplaythrough",l,!1),a.load()}return e},urls:function(e){var t=this;return e?(t.stop(),t._urls="string"==typeof e?[e]:e,t._loaded=!1,t.load(),t):t._urls},play:function(e,n){var i=this;return"function"==typeof e&&(n=e),e&&"function"!=typeof e||(e="_default"),i._loaded?i._sprite[e]?(i._inactiveNode(function(s){s._sprite=e;var r=s._pos>0?s._pos:i._sprite[e][0]/1e3,o=0;i._webAudio?(o=i._sprite[e][1]/1e3-s._pos,s._pos>0&&(r=i._sprite[e][0]/1e3+r)):o=i._sprite[e][1]/1e3-(r-i._sprite[e][0]/1e3);var a,u=!(!i._loop&&!i._sprite[e][2]),l="string"==typeof n?n:Math.round(Date.now()*Math.random())+"";if(function(){var t={id:l,sprite:e,loop:u};a=setTimeout(function(){!i._webAudio&&u&&i.stop(t.id).play(e,t.id),i._webAudio&&!u&&(i._nodeById(t.id).paused=!0,i._nodeById(t.id)._pos=0,i._clearEndTimer(t.id)),i._webAudio||u||i.stop(t.id),i.on("end",l)},1e3*o),i._onendTimer.push({timer:a,id:t.id})}(),i._webAudio){var d=i._sprite[e][0]/1e3,h=i._sprite[e][1]/1e3;s.id=l,s.paused=!1,f(i,[u,d,h],l),i._playStart=t.currentTime,s.gain.value=i._volume,"undefined"==typeof s.bufferSource.start?u?s.bufferSource.noteGrainOn(0,r,86400):s.bufferSource.noteGrainOn(0,r,o):u?s.bufferSource.start(0,r,86400):s.bufferSource.start(0,r,o)}else{if(4!==s.readyState&&(s.readyState||!navigator.isCocoonJS))return i._clearEndTimer(l),function(){var t=i,r=e,o=n,a=s,u=function(){t.play(r,o),a.removeEventListener("canplaythrough",u,!1)};a.addEventListener("canplaythrough",u,!1)}(),i;s.readyState=4,s.id=l,s.currentTime=r,s.muted=c._muted||s.muted,s.volume=i._volume*c.volume(),setTimeout(function(){s.play()},0)}return i.on("play"),"function"==typeof n&&n(l),i}),i):("function"==typeof n&&n(),i):(i.on("load",function(){i.play(e,n)}),i)},pause:function(e){var t=this;if(!t._loaded)return t.on("play",function(){t.pause(e)}),t;t._clearEndTimer(e);var n=e?t._nodeById(e):t._activeNode();if(n)if(n._pos=t.pos(null,e),t._webAudio){if(!n.bufferSource||n.paused)return t;n.paused=!0,"undefined"==typeof n.bufferSource.stop?n.bufferSource.noteOff(0):n.bufferSource.stop(0)}else n.pause();return t.on("pause"),t},stop:function(e){var t=this;if(!t._loaded)return t.on("play",function(){t.stop(e)}),t;t._clearEndTimer(e);var n=e?t._nodeById(e):t._activeNode();if(n)if(n._pos=0,t._webAudio){if(!n.bufferSource||n.paused)return t;n.paused=!0,"undefined"==typeof n.bufferSource.stop?n.bufferSource.noteOff(0):n.bufferSource.stop(0)}else isNaN(n.duration)||(n.pause(),n.currentTime=0);return t},mute:function(e){var t=this;if(!t._loaded)return t.on("play",function(){t.mute(e)}),t;var n=e?t._nodeById(e):t._activeNode();return n&&(t._webAudio?n.gain.value=0:n.muted=!0),t},unmute:function(e){var t=this;if(!t._loaded)return t.on("play",function(){t.unmute(e)}),t;var n=e?t._nodeById(e):t._activeNode();return n&&(t._webAudio?n.gain.value=t._volume:n.muted=!1),t},volume:function(e,t){var n=this;if(e=parseFloat(e),e>=0&&1>=e){if(n._volume=e,!n._loaded)return n.on("play",function(){n.volume(e,t)}),n;var i=t?n._nodeById(t):n._activeNode();return i&&(n._webAudio?i.gain.value=e:i.volume=e*c.volume()),n}return n._volume},loop:function(e){var t=this;return"boolean"==typeof e?(t._loop=e,t):t._loop},sprite:function(e){var t=this;return"object"==typeof e?(t._sprite=e,t):t._sprite},pos:function(e,n){var i=this;if(!i._loaded)return i.on("load",function(){i.pos(e)}),"number"==typeof e?i:i._pos||0;e=parseFloat(e);var s=n?i._nodeById(n):i._activeNode();if(s)return e>=0?(i.pause(n),s._pos=e,i.play(s._sprite,n),i):i._webAudio?s._pos+(t.currentTime-i._playStart):s.currentTime;if(e>=0)return i;for(var r=0;r<i._audioNode.length;r++)if(i._audioNode[r].paused&&4===i._audioNode[r].readyState)return i._webAudio?i._audioNode[r]._pos:i._audioNode[r].currentTime},pos3d:function(e,t,n,i){var s=this;if(t="undefined"!=typeof t&&t?t:0,n="undefined"!=typeof n&&n?n:-.5,!s._loaded)return s.on("play",function(){s.pos3d(e,t,n,i)}),s;if(!(e>=0||0>e))return s._pos3d;if(s._webAudio){var r=i?s._nodeById(i):s._activeNode();r&&(s._pos3d=[e,t,n],r.panner.setPosition(e,t,n),r.panner.panningModel=s._model||"HRTF")}return s},fade:function(e,t,n,i,s){var r=this,o=Math.abs(e-t),a=e>t?"down":"up",u=o/.01,c=n/u;if(!r._loaded)return r.on("load",function(){r.fade(e,t,n,i,s)}),r;r.volume(e,s);for(var l=1;u>=l;l++)!function(){var e=r._volume+("up"===a?.01:-.01)*l,n=Math.round(1e3*e)/1e3,o=t;setTimeout(function(){r.volume(n,s),n===o&&i&&i()},c*l)}()},fadeIn:function(e,t,n){return this.volume(0).play().fade(0,e,t,n)},fadeOut:function(e,t,n,i){var s=this;return s.fade(s._volume,e,t,function(){n&&n(),s.pause(i),s.on("end")},i)},_nodeById:function(e){for(var t=this,n=t._audioNode[0],i=0;i<t._audioNode.length;i++)if(t._audioNode[i].id===e){n=t._audioNode[i];break}return n},_activeNode:function(){for(var e=this,t=null,n=0;n<e._audioNode.length;n++)if(!e._audioNode[n].paused){t=e._audioNode[n];break}return e._drainPool(),t},_inactiveNode:function(e){for(var t=this,n=null,i=0;i<t._audioNode.length;i++)if(t._audioNode[i].paused&&4===t._audioNode[i].readyState){e(t._audioNode[i]),n=!0;break}if(t._drainPool(),!n){var s;if(t._webAudio)s=t._setupAudioNode(),e(s);else{t.load(),s=t._audioNode[t._audioNode.length-1];var r=navigator.isCocoonJS?"canplaythrough":"loadedmetadata",o=function(){s.removeEventListener(r,o,!1),e(s)};s.addEventListener(r,o,!1)}}},_drainPool:function(){var e,t=this,n=0;for(e=0;e<t._audioNode.length;e++)t._audioNode[e].paused&&n++;for(e=t._audioNode.length-1;e>=0&&!(5>=n);e--)t._audioNode[e].paused&&(t._webAudio&&t._audioNode[e].disconnect(0),n--,t._audioNode.splice(e,1))},_clearEndTimer:function(e){for(var t=this,n=0,i=0;i<t._onendTimer.length;i++)if(t._onendTimer[i].id===e){n=i;break}var s=t._onendTimer[n];s&&(clearTimeout(s.timer),t._onendTimer.splice(n,1))},_setupAudioNode:function(){var e=this,n=e._audioNode,i=e._audioNode.length;return n[i]="undefined"==typeof t.createGain?t.createGainNode():t.createGain(),n[i].gain.value=e._volume,n[i].paused=!0,n[i]._pos=0,n[i].readyState=4,n[i].connect(r),n[i].panner=t.createPanner(),n[i].panner.panningModel=e._model||"equalpower",n[i].panner.setPosition(e._pos3d[0],e._pos3d[1],e._pos3d[2]),n[i].panner.connect(n[i]),n[i]},on:function(e,t){var n=this,i=n["_on"+e];if("function"==typeof t)i.push(t);else for(var s=0;s<i.length;s++)t?i[s].call(n,t):i[s].call(n);return n},off:function(e,t){var n=this,i=n["_on"+e],s=t?t.toString():null;if(s){for(var r=0;r<i.length;r++)if(s===i[r].toString()){i.splice(r,1);break}}else n["_on"+e]=[];return n},unload:function(){for(var t=this,n=t._audioNode,i=0;i<t._audioNode.length;i++)n[i].paused||(t.stop(n[i].id),t.on("end",n[i].id)),t._webAudio?n[i].disconnect(0):n[i].src="";for(i=0;i<t._onendTimer.length;i++)clearTimeout(t._onendTimer[i].timer);var s=c._howls.indexOf(t);null!==s&&s>=0&&c._howls.splice(s,1),delete e[t._src],t=null}},n)var d=function(t,n){if(n in e)return t._duration=e[n].duration,void p(t);if(/^data:[^;]+;base64,/.test(n)){for(var i=atob(n.split(",")[1]),s=new Uint8Array(i.length),r=0;r<i.length;++r)s[r]=i.charCodeAt(r);h(s.buffer,t,n)}else{var o=new XMLHttpRequest;o.open("GET",n,!0),o.responseType="arraybuffer",o.onload=function(){h(o.response,t,n)},o.onerror=function(){t._webAudio&&(t._buffer=!0,t._webAudio=!1,t._audioNode=[],delete t._gainNode,delete e[n],t.load())};try{o.send()}catch(a){o.onerror()}}},h=function(n,i,s){t.decodeAudioData(n,function(t){t&&(e[s]=t,p(i,t))},function(e){i.on("loaderror")})},p=function(e,t){e._duration=t?t.duration:e._duration,0===Object.getOwnPropertyNames(e._sprite).length&&(e._sprite={_default:[0,1e3*e._duration]}),e._loaded||(e._loaded=!0,e.on("load")),e._autoplay&&e.play()},f=function(n,i,s){var r=n._nodeById(s);r.bufferSource=t.createBufferSource(),r.bufferSource.buffer=e[n._src],r.bufferSource.connect(r.panner),r.bufferSource.loop=i[0],i[0]&&(r.bufferSource.loopStart=i[1],r.bufferSource.loopEnd=i[1]+i[2]),r.bufferSource.playbackRate.value=n._rate};"function"==typeof define&&define.amd&&define(function(){return{Howler:c,Howl:l}}),"undefined"!=typeof exports&&(exports.Howler=c,exports.Howl=l),"undefined"!=typeof window&&(window.Howler=c,window.Howl=l)}(),using().define("MO5.ajax",function(){return using.ajax}),function(){function e(e,t,n,i,s){function r(e){if(t.call(this),this.callbacks=new n,this.queue=new n,this.running=!1,this.canceled=!1,this.paused=!1,this.limit=0,this.count=0,this.currentWatcher=null,e&&e instanceof n)this.callbacks=e;else if(e&&e instanceof Array)this.callbacks.replace(e.slice());else if(e)throw new Error("Parameter 1 is expected to be of type Array or MO5.Queue.")}return r.prototype=new t,r.prototype.constructor=r,r.prototype.addStep=function(e){if(this.running)throw new Error("Cannot add steps to a running animation.");return this.callbacks.add(e),this.trigger("updated",null,!1),this},r.prototype.isRunning=function(){return this.running},r.prototype.isCanceled=function(){return this.canceled},r.prototype.isPaused=function(){return this.paused},r.prototype.start=function(){var e,t,n=this;if(this.running)throw new Error("Animation is already running.");return t=this.callbacks.clone(),this.queue=t,this.running=!0,this.canceled=!1,e=function(){var i,r;return t.hasNext()?(i=t.next(),r=i(),void(r&&r instanceof s?(n.currentWatcher=r,r.once(e,"stopped")):setTimeout(e,0))):(n.count+=1,n.isRunning()?n.limit&&n.count==n.limit?(n.running=!1,n.trigger("stopped",null,!1),n.count=0,void(n.limit=0)):(t=n.callbacks.clone(),this.queue=t,void setTimeout(e,0)):void n.trigger("stopped",null,!1))},setTimeout(e,0),this},r.prototype.pause=function(){if(this.paused)throw new Error("Trying to pause an already paused animation.");return this.paused=!0,this.currentWatcher&&this.currentWatcher.pause(),this.trigger("paused",null,!1),this},r.prototype.resume=function(){if(!this.paused)throw new Error("Trying to resume an animation that isn't paused.");return this.paused=!1,this.currentWatcher&&this.currentWatcher.resume(),this.trigger("resumed",null,!1),this},r.prototype.cancel=function(){if(this.canceled)throw new Error("Trying to cancel an already canceled animation.");return this.canceled=!0,this.running=!1,this.count=0,this.limit=0,this.currentWatcher&&this.currentWatcher.cancel(),this.trigger("canceled",null,!1),this},r.prototype.stop=function(){if(!this.running)throw new Error("Trying to stop an animation that isn't running. Check isRunning() beforehand.");return this.running=!1,this.count=0,this.limit=0,this},r.prototype.loop=function(e){if(1>e)throw new Error("Parameter 1 is expected to be greater than zero.");return this.count=0,this.limit=e,this.start()},r.prototype.promise=function(){return i.prototype.promise.call(this)},r}"function"==typeof using?using("MO5.Exception","MO5.CoreObject","MO5.Queue","MO5.Timer","MO5.TimerWatcher").define("MO5.Animation",e):"undefined"!=typeof window?window.MO5.Animation=e(MO5.Exception,MO5.CoreObject,MO5.Queue,MO5.Timer,MO5.TimerWatcher):module.exports=e(require("./Exception.js"),require("./CoreObject.js"),require("./Queue.js"),require("./Timer.js"),require("./TimerWatcher.js"))}(),using("MO5.Exception").define("MO5.assert",function(e){function t(){e.apply(this,arguments),this.name="AssertionException"}function n(e,n){if(!e)throw new t(n)}return t.prototype=new e,n}),function(){function e(e,t,n){function i(e){e=e||{},e.bus=e.bus||{},u+=1,Object.defineProperty?Object.defineProperty(this,"id",{value:u,configurable:!1,enumerable:!1,writable:!1}):this.id=u,this.destroyed=!1,n.inject(this,e.bus),o[this.id]={},this.$children=[],this.$parent=null}function s(e){return a+e}function r(e){return e.replace(new RegExp(a),"")}var o={},a="CoreObject",u=0;return i.hasId=function(e){return"object"==typeof e&&null!==e&&"number"==typeof e.id},i.isCoreObject=function(e){return e instanceof i},i.prototype.addChild=function(e){this.$children.indexOf(e)>=0||(e.$parent=this,this.$children.push(e))},i.prototype.removeChild=function(e){var t=this.$children.indexOf(e);0>t||(e.$parent=null,this.$children.splice(t,1))},i.prototype.hasChild=function(e){return this.$children.indexOf(e)>=0},i.prototype.setFlag=function(e){var t=s(e);if(o[this.id])return o[this.id][t]=!0,this.trigger("flag_set",e),this},i.prototype.removeFlag=function(e){return this.hasFlag(e)?(delete o[this.id][s(e)],this.trigger("flag_removed",e),this):void 0},i.prototype.hasFlag=function(e){var t=s(e);return o[this.id]&&o[this.id].hasOwnProperty(t)},i.prototype.getFlags=function(){var e=[];for(var t in o[this.id])e.push(r(t));return e},i.prototype.connect=function(t,n,s,r){function o(e){e=e||null,"undefined"==typeof r||r!==!0&&r!==!1?n.trigger(s,e):n.trigger(s,e,r)}var a=this;if(t=t||"*",s=s||"*",!(n&&n instanceof i))throw new e("Cannot connect events: Parameter 3 is expected to be of type CoreObject.");return this.subscribe(o,t),n.once(function(){a.unsubscribe(o,t)},"destroyed"),this},i.prototype["implements"]=function(e){for(var t in e)if(typeof this[t]!=typeof e[t])return!1;return!0},i.prototype.toString=function(){return""+this.id},i.prototype.valueOf=function(){return this.id},i.prototype.destroy=function(){var e=this.id;this.$parent&&this.$parent.removeChild(this),this.$children.forEach(function(e){"object"==typeof e&&"function"==typeof e.destroy&&e.destroy()}),this.destroyed=!0,this.trigger("destroyed",null,!1);for(var t in this)this[t]=null;delete o[e],this.destroyed=!0,this.id=e,delete this.toString,delete this.valueOf},i.prototype.subscribeTo=function(t,n,i){function s(){t.unsubscribe(n,i),o.unsubscribe("destroyed",s),t.unsubscribe("destroyed",r)}function r(){t.unsubscribe("destroyed",r),o.unsubscribe("destroyed",s)}var o=this;if("function"!=typeof t.subscribe||"function"!=typeof t.unsubscribe)throw new e("Cannot subscribe: Parameter 1 is expected to be of type CoreObject or EventBus.");if("string"!=typeof n)throw new e("Cannot subscribe: Parameter 2 is expected to be of type String.");if("function"!=typeof i)throw new e("Cannot subscribe: Parameter 3 is expected to be of type Function.");return i=i.bind(this),t.subscribe(n,i),this.subscribe("destroyed",s),t.subscribe("destroyed",r),this},i}"function"==typeof using?using("MO5.Exception","MO5.fail","MO5.EventBus").define("MO5.CoreObject",e):"undefined"!=typeof window?window.MO5.CoreObject=e(MO5.Exception,MO5.fail,MO5.EventBus):module.exports=e(require("./Exception.js"),require("./fail.js"),require("./EventBus.js"))}(),using().define("MO5.dom.effects.typewriter",function(){function e(e,t){function n(e){var t,i,s=e.childNodes;if(e.nodeType===o)for(e.style.display="none",t=0,i=s.length;i>t;t+=1)n(s[t])}function i(e,t){e.nodeType===o?!function(){for(var n=[];e.hasChildNodes();)n.push(e.removeChild(e.firstChild));e.style.display="",function s(){n.length>0?(i(n[0],s),e.appendChild(n.shift())):t&&setTimeout(t,0)}()}():e.nodeType===a&&!function(){function n(){e.data+=o[i],i+=1,r>i?setTimeout(n,1e3/s):t&&setTimeout(t,0)}var i,r,o=e.data.replace(/ +/g," ");e.data="",i=0,r=o.length,n()}()}var s,r,o=1,a=3;t=t||{},s=t.speed||50,r=t.onFinish||null,n(e),i(e,r)}return e}),using("MO5.CoreObject","MO5.transform","MO5.TimerWatcher","MO5.dom.effects.typewriter","MO5.types","MO5.Point","MO5.Size").define("MO5.dom.Element",function(e,t,n,i,s,r,o){function a(t){var n=this;t=t||{},e.call(this),this.parent=t.parent||document.body,this.nodeType=t.nodeType||"div",this.element=t.element||document.createElement(this.nodeType),u(this,this.element),a.propertiesToExclude.forEach(function(e){delete n[e]})}function u(e,t){for(var n in t)!function(n,i){"id"!==i&&("function"==typeof n?e[i]=function(){return t[i].apply(t,arguments)}:e[i]=function(n){return arguments.length?(t[i]=n,e):t[i]})}(t[n],n)}function c(e,t){return-1!==e.indexOf(t)}return a.propertiesToExclude=["appendChild","removeChild"],a.fromDomElement=function(e){return new a({element:e,nodeType:e.nodeName})},a.prototype=new e,a.prototype.constructor=a,a.prototype.appendTo=function(e){return e.appendChild(this.element)},a.prototype.remove=function(){return this.element.parentNode.removeChild(this.element)},a.prototype.appendChild=function(e){var t=e instanceof a?e.element:e;return this.element.appendChild(t)},a.prototype.addAsFirstChild=function(e){var t=e instanceof a?e.element:e;return this.element.childElementCount>0?this.element.insertBefore(t,this.element.childNodes[0]):this.element.appendChild(t)},a.prototype.fadeIn=function(e){e=e||{};var n=this.element;return this._lastFadeTimer&&this._lastFadeTimer.isRunning()&&this._lastFadeTimer.cancel(),this.show(),this._lastFadeTimer=t(function(e){n.style.opacity=e},parseInt(n.style.opacity,10)||0,1,e),this._lastFadeTimer},a.prototype.fadeOut=function(e){e=e||{};var n=this.element;return this._lastFadeTimer&&this._lastFadeTimer.isRunning()&&this._lastFadeTimer.cancel(),this._lastFadeTimer=t(function(e){n.style.opacity=e},parseInt(n.style.opacity,10)||1,0,e),this._lastFadeTimer.once("stopped",this.hide.bind(this)),this._lastFadeTimer},a.prototype.opacity=function(e){return"number"==typeof e&&(this.element.style.opacity=e),this.element.style.opacity},a.prototype.position=function(e){var t,n,i=this.element,o={};return s.isObject(e)&&(i.style.left=""+ +e.x+"px",i.style.top=""+ +e.y+"px"),o.left=i.offsetLeft,o.top=i.offsetTop,i.getBoundingClientRect&&(o=i.getBoundingClientRect()),t=Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),n=Math.max(document.documentElement.scrollTop,document.body.scrollTop),new r(t+o.left,n+o.top)},a.prototype.size=function(e){return s.isObject(e)&&(this.element.style.width=""+e.width+"px",this.element.style.height=""+e.height+"px"),new o(this.element.offsetWidth,this.element.offsetHeight)},a.prototype.width=function(e){return s.isNumber(e)&&(this.element.style.width=""+e+"px"),this.element.offsetWidth},a.prototype.height=function(e){return s.isNumber(e)&&(this.element.style.height=""+e+"px"),this.element.offsetHeight},a.prototype.moveTo=function(e,i,s){s=s||{};var r,o,a=this.element,u=a.offsetLeft,c=a.offsetTop;return r=t(function(e){a.style.left=e+"px"},u,e,s),o=t(function(e){a.style.top=e+"px"},c,i,s),(new n).addTimer(r).addTimer(o)},a.prototype.move=function(e,t,n){n=n||{};var i=this.element,s=i.offsetLeft+e,r=i.offsetTop+t;return this.moveTo(s,r,n)},a.prototype.display=function(){this.element.style.visibility=""},a.prototype.show=a.prototype.display,a.prototype.hide=function(){this.element.style.visibility="hidden"},a.prototype.typewriter=function(e){e=e||{},i(this.element,e)},a.prototype.addCssClass=function(e){var t;return this.element.classList?(this.element.classList.add(e),this):(t=this.getCssClasses(),c(t,e)||(t.push(e),this.element.setAttribute("class",t.join(" "))),this)},a.prototype.removeCssClass=function(e){var t;return this.element.classList&&this.element.classList.remove(e),t=this.getCssClasses(),c(t,e)&&this.element.setAttribute("class",t.filter(function(t){return t!==e}).join(" ")),this},a.prototype.getCssClasses=function(){return(this.element.getAttribute("class")||"").split(" ")},a.prototype.hasCssClass=function(e){return this.element.classList?this.element.classList.contains(e):c(this.getCssClasses(),e)},a.prototype.clearCssClasses=function(){return this.element.setAttribute("class",""),this},a.prototype.setCssId=function(e){return this.element.setAttribute("id",e),this},a.prototype.destroy=function(){try{this.element.parentNode.removeChild(this.element)}catch(t){console.log(t)}e.prototype.destroy.call(this)},a}),using().define("MO5.dom.escape",function(){function e(e){var t="";return t=e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}return e}),using().define("MO5.easing",function(){function e(e){return function(t){return function(n,i){return s[e](t,n,i)}}}function t(t){return e("easeIn")(t)}function n(t){return e("easeOut")(t)}function i(t){return e("easeInOut")(t)}var s=function(e){"use asm";function t(e,t){e=e|0;t=t|0;return+(t/e)}function n(t,n){t=t|0;n=n|0;var i=+(e.Math.PI/(2*t));var s=+e.Math.abs(e.Math.sin(n*i));return+s}function i(t,n){t=t|0;n=n|0;var i=+(e.Math.PI/(2*t));var s=+e.Math.abs(-e.Math.cos(n*i)+1);return+s}function s(e,t){e=e|0;t=t|0;if(+(t/(e/2)<1)){return+i(e,t)}else{return+n(e,t)}}function r(e,t){e=e|0;t=t|0;var n=0,i=1,s=0.0;if((t/=e)<1/2.75){s=+(i*(7.5625*t*t)+n)}else if(t<2/2.75){s=+(i*(7.5625*(t-=1.5/2.75)*t+0.75)+n)}else if(t<2.5/2.75){s=+(i*(7.5625*(t-=2.25/2.75)*t+0.9375)+n)}else{s=+(i*(7.5625*(t-=2.625/2.75)*t+0.984375)+n);
}return+s}function o(t,n,i){n=n|0;i=i|0;return+(1-e.Math.pow(1-i/n,t))}function a(t,n,i){n=n|0;i=i|0;return+e.Math.pow(i/n,t)}function u(e,t,n){t=t|0;n=n|0;var i=0.0;if(n>t/2){i=+o(e,t,n)}else{i=+a(e,t,n)}return+i}return{linear:t,sineEaseOut:n,sineEaseIn:i,sineEaseInOut:s,easeOutBounce:r,easeIn:a,easeOut:o,easeInOut:u}}(window);return s.easingFunctionGenerator=e,s.createEaseInFunction=t,s.createEaseOutFunction=n,s.createEaseInOutFunction=i,s.easeInQuad=t(2),s.easeInCubic=t(3),s.easeInQuart=t(4),s.easeInQuint=t(5),s.easeOutQuad=n(2),s.easeOutCubic=n(3),s.easeOutQuart=n(4),s.easeOutQuint=n(5),s.easeInOutQuad=i(2),s.easeInOutCubic=i(3),s.easeInOutQuart=i(4),s.easeInOutQuint=i(5),s}),function(){function e(){"use strict";function e(t){function n(e){var t;i.debug===!0&&(t=e.error.name||"Error",console.log(t+" in listener; Event: "+e.info.event+"; Message: "+e.error.message))}var i=this;t=t||{},this.debug=t.debug||!1,this.interceptErrors=t.interceptErrors||!1,this.log=t.log||!1,this.logData=t.logData||!1,this.defaults=t.defaults||{},this.defaults.flowType=this.defaults.flowType||e.FLOW_TYPE_ASYNCHRONOUS,this.callbacks={"*":[]},this.subscribe(n,"EventBus.error")}return e.FLOW_TYPE_ASYNCHRONOUS=0,e.FLOW_TYPE_SYNCHRONOUS=1,e.create=function(t){return t=t||{},new e(t)},e.prototype.subscribe=function(e,t){var n,i,s=this;if(void 0===t?(i="*",n=e):"string"==typeof e||"number"==typeof e?(i=e,n=t):("string"==typeof t||"number"==typeof t)&&(i=t,n=e),"string"!=typeof i&&"number"!=typeof i)throw new Error("Event names can only be strings or numbers! event: ",i);if("function"!=typeof n)throw new Error("Only functions may be used as listeners!");return i=i||"*",this.callbacks[i]=this.callbacks[i]||[],this.callbacks[i].push(n),this.trigger("EventBus.subscribe",{listener:n,event:i,bus:this}),function(){s.unsubscribe(n,i)}},e.prototype.unsubscribe=function(e,t){var n,i,s,r,o;if(void 0===t?(o="*",r=e):"string"==typeof e||"number"==typeof e?(o=e,r=t):("string"==typeof t||"number"==typeof t)&&(o=t,r=e),"string"!=typeof o&&"number"!=typeof o)throw new Error("Event names can only be strings or numbers! event: ",o);if("function"!=typeof r)throw new Error("Only functions may be used as listeners!");for(o=o||"*",n=this.callbacks[o]||[],i=n.length,s=0;i>s;++s)n[s]===r&&this.callbacks[o].splice(s,1);this.trigger("EventBus.unsubscribe",{listener:r,event:o,bus:this})},e.prototype.once=function(e,t){var n,i,s,r,o,a=this,u=!1;if(r="function"==typeof e,o="function"==typeof t,r&&o||!r&&!o)throw new Error("Parameter mismatch; one parameter needs to be a function, the other one must be a string.");r?(s=e,i=t):(s=t,i=e),i=i||"*",n=function(e,t){u||(u=!0,a.unsubscribe(n,i),s(e,t))},this.subscribe(n,i)},e.prototype.trigger=function(t,n,i){function s(e){setTimeout(function(){throw e},0)}var r,o,a,u,c,l,d,h;if("undefined"!=typeof t&&"string"!=typeof t&&"number"!=typeof t)throw new Error("Event names can only be strings or numbers! event: ",t);d=this,t=arguments.length?t:"*",h="undefined"!=typeof i&&i===!1?e.FLOW_TYPE_SYNCHRONOUS:this.defaults.flowType,r=function(){var e,n,i,s,r,o,a="",u=[];for(n=t.split("."),e=0,i=n.length;i>e;++e)for(a=a+(e>0?".":"")+n[e],s=d.callbacks[a]||[],r=0,o=s.length;o>r;++r)u.push(s[r]);if("*"===t)return u;for(s=d.callbacks["*"]||[],r=0,o=s.length;o>r;++r)u.push(s[r]);return u}(),o=r.length,a={event:t,subscribers:o,async:h===e.FLOW_TYPE_ASYNCHRONOUS?!0:!1,getQueueLength:function(){return 0===o?0:o-(u+1)}},c=function(){for(d.log===!0&&console.log("EventBus event triggered: "+t+"; Subscribers: "+o,d.logData===!0?"; Data: "+n:""),u=0;o>u;++u){l=r[u];try{l(n,a)}catch(e){console.log(e),d.trigger("EventBus.error",{error:e,info:a}),d.interceptErrors!==!0&&s(e)}}},h===e.FLOW_TYPE_ASYNCHRONOUS?setTimeout(c,0):c()},e.prototype.triggerSync=function(e,t){return this.trigger(e,t,!1)},e.prototype.triggerAsync=function(e,t){return this.trigger(e,t,!0)},e.inject=function(t,n){n=n||{};var i=new e(n);t.subscribe=function(e,t){i.subscribe(e,t)},t.unsubscribe=function(e,t){i.unsubscribe(e,t)},t.once=function(e,t){i.once(e,t)},t.trigger=function(e,t,n){n="undefined"!=typeof n&&n===!1?!1:!0,i.trigger(e,t,n)},t.triggerSync=i.triggerSync.bind(i),t.triggerAsync=i.triggerAsync.bind(i),t.subscribe("destroyed",function(){i.callbacks=[]})},e}"function"==typeof using?using().define("MO5.EventBus",e):"undefined"!=typeof window?(window.MO5=MO5||{},window.MO5.EventBus=e()):module.exports=e()}(),function(){function e(){function e(e){var t,n=Error.apply(null,arguments);for(t in n)this[t]=n[t];this.message=e,this.name="MO5.Exception"}return e.prototype=new Error,e.prototype.constructor=e,e}"function"==typeof using?using().define("MO5.Exception",e):"undefined"!=typeof window?(window.MO5=window.MO5||{},window.MO5.Exception=e()):module.exports=e()}(),function(){function e(){function e(e){console.error?console.error(e.toString()):console.log(e.toString()),e.stack&&console.log(e.stack)}return e}"function"==typeof using?using().define("MO5.fail",e):"undefined"!=typeof window?window.MO5.fail=e():module.exports=e()}(),using().define("MO5.globals.document",function(){return document}),using().define("MO5.globals.window",function(){return window}),function(){function e(e,t,n){function i(t){e.call(this),this.unsubscribers={},this.items=n.isArray(t)?t:[]}return i.prototype=new e,i.prototype.length=function(){return this.items.length},i.prototype.append=function(t){function n(){var e,n;for(e=0,n=s.items.length;n>e;e+=1)s.items[e]===t&&s.items.splice(e,1);delete s.unsubscribers[t.id]}function i(){t.unsubscribe(n,"destroyed")}var s=this;return e.isCoreObject(t)&&(this.unsubscribers[t.id]=i,t.subscribe(n,"destroyed"),t.subscribe("destroyed",function(){t=null})),this.items.push(t),this},i.prototype.remove=function(t){var n=this.items[t];return e.isCoreObject(n)&&(this.unsubscribers[n.id](),delete this.unsubscribers[n.id]),this.items.splice(t,1),this},i.prototype.clear=function(){var e=this;this.forEach(function(t,n){e.remove(n)})},i.prototype.at=function(e){return this.items[+e]},i.prototype.indexOf=function(e){return this.items.indexOf(e)},i.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},i.prototype.toQueue=function(){var e=new t;return this.items.forEach(function(t){e.add(t)}),e},i.prototype.forEach=function(e){this.items.forEach(e)},i.prototype.filter=function(e){return this.items.filter(e)},i.prototype.map=function(e){return this.items.map(e)},i.prototype.reduce=function(e){return this.items.reduce(e)},i.prototype.every=function(e){return this.items.every(e)},i.prototype.some=function(e){return this.items.some(e)},i.prototype.find=function(e){var t,n=this.items.length;for(t=0;n>t;t+=1)if(e(this.items[t]))return this.items[t];return void 0},i.prototype.combine=function(e){return new i(this.items.slice().concat(e.items))},i.prototype.clone=function(){return new i(this.items.slice())},i.prototype.destroy=function(){if(!this.destroyed){for(var t=0;t<this.unsubscribers.length;t++)this.unsubscribers[t](),delete this.unsubscribers[t];e.prototype.destroy.apply(this,arguments)}},i}"function"==typeof using?using("MO5.CoreObject","MO5.Queue","MO5.types").define("MO5.List",e):"undefined"!=typeof window?window.MO5.List=e(MO5.CoreObject,MO5.Queue,MO5.types):module.exports=e(require("./CoreObject.js"),require("./Queue.js"),require("./types.js"))}(),function(){function e(e,t){function n(e){return r+e}function i(e){return e.replace(new RegExp(r),"")}function s(t){var n;if(e.call(this),this.clear(),t)for(n in t)this.set(n,t[n])}var r="MO5Map";return s.prototype=new e,s.prototype.clear=function(){this.items={},this.unsubscribers={},this.count=0},s.prototype.length=function(){return this.count},s.prototype.set=function(t,i){function s(){r.has(t)&&r.remove(t)}var r=this,o=n(t);if(!t)throw new Error("MO5.Map keys cannot be falsy.");if(this.has(o)&&this.remove(o),i&&i instanceof e){if(i.destroyed)throw new Error("Trying to add an MO5.Object that has already been destroyed.");i.subscribe(s,"destroyed")}if(t instanceof e){if(t.destroyed)throw new Error("Trying to use an MO5.Object as key that has already been destroyed.");t.subscribe(s,"destroyed")}return(i&&i instanceof e||t instanceof e)&&(this.unsubscribers[o]=function(){i instanceof e&&i.unsubscribe(s,"destroyed"),t instanceof e&&t.unsubscribe(s,"destroyed")}),this.items[o]=i,this.count+=1,this.trigger("updated",null,!1),this.trigger("set",o,!1),this},s.prototype.get=function(e){var t=n(e);return this.items.hasOwnProperty(t)?this.items[t]:void 0},s.prototype.require=function(e){if(!this.has(e))throw new Error("Required key '"+e+"' does not exist.");return this.get(e)},s.prototype.remove=function(e){var t=n(e);if(!this.has(e))throw new Error("Trying to remove an unknown key from an MO5.Map.");return this.unsubscribers.hasOwnProperty(t)&&(this.unsubscribers[t](),delete this.unsubscribers[t]),delete this.items[t],this.count-=1,this.trigger("updated",null,!1),this.trigger("removed",t,!1),this},s.prototype.has=function(e){var t=n(e);return this.items.hasOwnProperty(t)},s.prototype.destroy=function(){for(var t in this.unsubscribers)this.unsubscribers[t](),delete this.unsubscribers[t];e.prototype.destroy.call(this)},s.prototype.forEach=function(e){if(!e||"function"!=typeof e)throw new Error("Parameter 1 is expected to be of type function.");for(var t in this.items)e(this.items[t],i(t),this);return this},s.prototype.filter=function(e){var t=new s;return this.forEach(function(n,i,s){e(n,i,s)&&t.set(i,n)}),t},s.prototype.find=function(e){var t,n=!1;return this.forEach(function(i,s,r){!n&&e(i,s,r)&&(t=i,n=!0)}),t},s.prototype.map=function(e){var t=new s;return this.forEach(function(n,i,s){t.set(i,e(n,i,s))}),t},s.prototype.reduce=function(e,t){var n=t;return this.forEach(function(t,i,s){n=e(n,t,i,s)}),n},s.prototype.every=function(e){return this.reduce(function(t,n,i,s){return t&&e(n,i,s)},!0)},s.prototype.some=function(e){var t=!1;return this.forEach(function(n,i,s){!t&&e(n,i,s)&&(t=!0)}),t},s.prototype.keys=function(){var e=[];return this.forEach(function(t,n){e.push(n)}),e},s.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},s.prototype.toObject=function(){var e={};return this.forEach(function(t,n){e[n]=t}),e},s.prototype.clone=function(){var e=new s;return this.forEach(function(t,n){e.set(n,t)}),e},s.prototype.addMap=function(e){var t=this;return e.forEach(function(e,n){t.set(n,e)}),this},s.prototype.join=function(e){return this.clone().addMap(e)},s}"function"==typeof using?using("MO5.CoreObject","MO5.Exception").define("MO5.Map",e):"undefined"!=typeof window?window.MO5.Map=e(MO5.CoreObject,MO5.Exception):module.exports=e(require("./CoreObject.js"),require("./Exception.js"))}(),using().define("MO5.Point",function(){function e(e,t){this.x=e,this.y=t}return e.prototype.getDistance=function(e){var t=this.x-e.x,n=this.y-e.y,i=Math.squrt(t*t+n*n);return i},e}),function(){var e,t,n,i;!function(){var s={},r={};e=function(e,t,n){s[e]={deps:t,callback:n}},i=n=t=function(e){function n(t){if("."!==t.charAt(0))return t;for(var n=t.split("/"),i=e.split("/").slice(0,-1),s=0,r=n.length;r>s;s++){var o=n[s];if(".."===o)i.pop();else{if("."===o)continue;i.push(o)}}return i.join("/")}if(i._eak_seen=s,r[e])return r[e];if(r[e]={},!s[e])throw new Error("Could not find module "+e);for(var o,a=s[e],u=a.deps,c=a.callback,l=[],d=0,h=u.length;h>d;d++)"exports"===u[d]?l.push(o={}):l.push(t(n(u[d])));var p=c.apply(this,l);return r[e]=o||p}}(),e("promise/all",["./utils","exports"],function(e,t){"use strict";function n(e){var t=this;if(!i(e))throw new TypeError("You must pass an array to all.");return new t(function(t,n){function i(e){return function(t){r(e,t)}}function r(e,n){a[e]=n,0===--u&&t(a)}var o,a=[],u=e.length;0===u&&t([]);for(var c=0;c<e.length;c++)o=e[c],o&&s(o.then)?o.then(i(c),n):r(c,o)})}var i=e.isArray,s=e.isFunction;t.all=n}),e("promise/asap",["exports"],function(e){"use strict";function t(){return function(){process.nextTick(s)}}function n(){var e=0,t=new u(s),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function i(){return function(){c.setTimeout(s,1)}}function s(){for(var e=0;e<l.length;e++){var t=l[e],n=t[0],i=t[1];n(i)}l=[]}function r(e,t){var n=l.push([e,t]);1===n&&o()}var o,a="undefined"!=typeof window?window:{},u=a.MutationObserver||a.WebKitMutationObserver,c="undefined"!=typeof global?global:void 0===this?window:this,l=[];o="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?t():u?n():i(),e.asap=r}),e("promise/config",["exports"],function(e){"use strict";function t(e,t){return 2!==arguments.length?n[e]:void(n[e]=t)}var n={instrument:!1};e.config=n,e.configure=t}),e("promise/polyfill",["./promise","./utils","exports"],function(e,t,n){"use strict";function i(){var e;e="undefined"!=typeof global?global:"undefined"!=typeof window&&window.document?window:self;var t="Promise"in e&&"resolve"in e.Promise&&"reject"in e.Promise&&"all"in e.Promise&&"race"in e.Promise&&function(){var t;return new e.Promise(function(e){t=e}),r(t)}();t||(e.Promise=s)}var s=e.Promise,r=t.isFunction;n.polyfill=i}),e("promise/promise",["./config","./utils","./all","./race","./resolve","./reject","./asap","exports"],function(e,t,n,i,s,r,o,a){"use strict";function u(e){if(!E(e))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof u))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._subscribers=[],c(e,this)}function c(e,t){function n(e){f(t,e)}function i(e){g(t,e)}try{e(n,i)}catch(s){i(s)}}function l(e,t,n,i){var s,r,o,a,u=E(n);if(u)try{s=n(i),o=!0}catch(c){a=!0,r=c}else s=i,o=!0;p(t,s)||(u&&o?f(t,s):a?g(t,r):e===W?f(t,s):e===M&&g(t,s))}function d(e,t,n,i){var s=e._subscribers,r=s.length;s[r]=t,s[r+W]=n,s[r+M]=i}function h(e,t){for(var n,i,s=e._subscribers,r=e._detail,o=0;o<s.length;o+=3)n=s[o],i=s[o+t],l(t,n,i,r);e._subscribers=null}function p(e,t){var n,i=null;try{if(e===t)throw new TypeError("A promises callback cannot return that same promise.");if(w(t)&&(i=t.then,E(i)))return i.call(t,function(i){return n?!0:(n=!0,void(t!==i?f(e,i):m(e,i)))},function(t){return n?!0:(n=!0,void g(e,t))}),!0}catch(s){return n?!0:(g(e,s),!0)}return!1}function f(e,t){e===t?m(e,t):p(e,t)||m(e,t)}function m(e,t){e._state===x&&(e._state=O,e._detail=t,v.async(y,e))}function g(e,t){e._state===x&&(e._state=O,e._detail=t,v.async(b,e))}function y(e){h(e,e._state=W)}function b(e){h(e,e._state=M)}var v=e.config,w=(e.configure,t.objectOrFunction),E=t.isFunction,S=(t.now,n.all),_=i.race,A=s.resolve,k=r.reject,T=o.asap;v.async=T;var x=void 0,O=0,W=1,M=2;u.prototype={constructor:u,_state:void 0,_detail:void 0,_subscribers:void 0,then:function(e,t){var n=this,i=new this.constructor(function(){});if(this._state){var s=arguments;v.async(function(){l(n._state,i,s[n._state-1],n._detail)})}else d(this,i,e,t);return i},"catch":function(e){return this.then(null,e)}},u.all=S,u.race=_,u.resolve=A,u.reject=k,a.Promise=u}),e("promise/race",["./utils","exports"],function(e,t){"use strict";function n(e){var t=this;if(!i(e))throw new TypeError("You must pass an array to race.");return new t(function(t,n){for(var i,s=0;s<e.length;s++)i=e[s],i&&"function"==typeof i.then?i.then(t,n):t(i)})}var i=e.isArray;t.race=n}),e("promise/reject",["exports"],function(e){"use strict";function t(e){var t=this;return new t(function(t,n){n(e)})}e.reject=t}),e("promise/resolve",["exports"],function(e){"use strict";function t(e){if(e&&"object"==typeof e&&e.constructor===this)return e;var t=this;return new t(function(t){t(e)})}e.resolve=t}),e("promise/utils",["exports"],function(e){"use strict";function t(e){return n(e)||"object"==typeof e&&null!==e}function n(e){return"function"==typeof e}function i(e){return"[object Array]"===Object.prototype.toString.call(e)}var s=Date.now||function(){return(new Date).getTime()};e.objectOrFunction=t,e.isFunction=n,e.isArray=i,e.now=s}),t("promise/polyfill").polyfill()}(),function(){function e(){function e(e){var t,n,i=new Promise(function(e,s){t=function(t){return e(t),i},n=function(e){return s(e),i}});return i.success=t,i.failure=n,i.resolve=t,i.reject=n,"function"==typeof e&&e(t,n),i}return e.resolve=Promise.resolve,e.reject=Promise.reject,e.all=Promise.all,e.race=Promise.race,e.consolify=function(e){e.then(console.log.bind(console))["catch"](function(e){console.error(e),console.log(e.stack)})},e}"function"==typeof using?using().define("MO5.Promise",e):"undefined"!=typeof window?window.MO5.Promise=e():module.exports=e()}(),function(){function e(e,t){function n(n){if(t.call(this),n&&!(n instanceof Array))throw new e("Parameter 1 is expected to be of type Array.");this.arr=n||[]}return n.prototype=new t,n.prototype.constructor=n,n.prototype.length=function(){return this.arr.length},n.prototype.add=function(n){var i=this,s=this.arr.length;if(n instanceof t){if(n.destroyed)throw new e("Trying to add an MO5.Object that has already been destroyed.");n.once(function(){i.destroyed||i.arr.splice(s,1)},"destroyed")}return this.arr.push(n),this.trigger("updated"),this.trigger("added",n),this},n.prototype.replace=function(t){if(!(t instanceof Array))throw new e("Parameter 1 is expected to be of type Array.");return this.arr=t,this.trigger("updated"),this.trigger("replaced",t),this},n.prototype.next=function(){if(!this.hasNext())throw new e("Calling next() on empty queue.");var t=this.arr.shift();return this.trigger("updated"),this.trigger("next"),this.arr.length<1&&this.trigger("emptied"),t},n.prototype.peak=function(){return this.isEmpty()?void 0:this.arr[0]},n.prototype.isEmpty=function(){return!this.hasNext()},n.prototype.hasNext=function(){return this.arr.length>0},n.prototype.clear=function(){return this.arr=[],this.trigger("updated"),this.trigger("cleared"),this},n.prototype.reverse=function(){for(var e=new n,t=this.length(),i=t-1;i>=0;)e.add(this.arr[i]),i-=1;return e},n.prototype.clone=function(){return new n(this.arr.slice())},n}"function"==typeof using?using("MO5.Exception","MO5.CoreObject").define("MO5.Queue",e):"undefined"!=typeof window?window.MO5.Queue=e(MO5.Exception,MO5.CoreObject):module.exports=e(require("./Exception.js"),require("./CoreObject.js"))}(),function(){function e(){function e(e,t){var n,i=[];for(n=e;t>=n;n+=1)i.push(n);return i}return e}"function"==typeof using?using().define("MO5.range",e):"undefined"!=typeof window?window.MO5.range=e():module.exports=e()}(),function(){function e(e,t,n,i){function s(e,t){for(;e.hasNext();)u(function(e){return function(){e(t)}}(e.next()))}function r(e,t,n,i){"function"==typeof n?t.add(function(e){var t;try{t=n(e),t&&t instanceof a?t.then(i.success,i.failure):i.success(t)}catch(s){i.failure(s)}return t}):t.add(function(t){i[e](t)})}function o(){e.call(this),this.successQueue=new t,this.failureQueue=new t,this.value=void 0,this.status=o.STATUS_PENDING,this.promise=new a(this)}function a(t){e.call(this),this.then=function(e,n){var i=new o;switch(t.status){case o.STATUS_PENDING:o.addToQueue("success",t.successQueue,e,i),o.addToQueue("failure",t.failureQueue,n,i);break;case o.STATUS_SUCCESS:o.addToQueue("success",t.successQueue,e,i),o.resolve(t.successQueue,t.value);break;case o.STATUS_FAILURE:o.addToQueue("failure",t.failureQueue,n,i),o.resolve(t.failureQueue,t.value)}return i.promise}}var u;return u="undefined"!=typeof window&&window.setImmediate?window.setImmediate:"undefined"!=typeof process?function(e){process.nextTick(e)}:function(e){setTimeout(e,0)},o.STATUS_PENDING=1,o.STATUS_FAILURE=2,o.STATUS_SUCCESS=3,o.getFulfilledPromise=function(){return(new o).success().promise},o.getBrokenPromise=function(){return(new o).failure().promise},o.prototype=new e,o.prototype.isPending=function(){return this.status===o.STATUS_PENDING},o.prototype.failure=function(e){return this.status!==o.STATUS_PENDING?void i(new n("The result of the action has already been determined.")):(this.value=e,this.status=o.STATUS_FAILURE,s(this.failureQueue,e),this.successQueue.clear(),this.failureQueue.clear(),this)},o.prototype.success=function(e){return this.status!==o.STATUS_PENDING?void i(new n("The result of the action has already been determined.")):(this.value=e,this.status=o.STATUS_SUCCESS,s(this.successQueue,e),this.successQueue.clear(),this.failureQueue.clear(),this)},o.addToQueue=r,o.resolve=s,a.prototype=new e,o}console.warn("MO5.Result is deprecated - use MO5.Promise instead!"),"function"==typeof using?using("MO5.CoreObject","MO5.Queue","MO5.Exception","MO5.fail").define("MO5.Result",e):"undefined"!=typeof window?window.MO5.CoreObject=e(MO5.CoreObject,MO5.Queue,MO5.Exception,MO5.fail):module.exports=e(require("./CoreObject.js"),require("./Queue.js"),require("./Exception.js"),require("./fail.js"))}(),function(){function e(e,t){function n(n){e.call(this),this._unsubscribers={},this._stringItems={},this._items=[],n&&t.hasForEach(n)&&this.addMany(n)}function i(e){return t.isObject(e)?t.isNumber(e.id)?!0:!1:!0}function s(e){return t.isObject(e)?r+"MO5CoreObject_"+e.id:r+"SimpleValue_"+JSON.stringify(e)}var r="MO5Set_";return n.fromRange=function(e,t){var i,s=new n;for(i=e;t>=i;i+=1)s.add(i);return s},n.prototype=new e,n.prototype.has=function(e){var t,n;if(i(e))return s(e)in this._stringItems;for(t=0,n=this._items.length;n>t;t+=1)if(this._items[t]===e)return!0;return!1},n.prototype.add=function(t){var n;return this.has(t)?this:(i(t)?(n=s(t),this._stringItems[n]=t,e.isCoreObject(t)&&(this._unsubscribers[n]=this["delete"].bind(this,t),t.subscribe("destroyed",this._unsubscribers[n]))):this._items.push(t),this)},n.prototype["delete"]=function(t){var n;return this.has(t)?(i(t)?(n=s(t),delete this._stringItems[n],e.isCoreObject(t)&&(t.unsubscribe("destroyed",this._unsubscribers[n]),delete this._unsubscribers[n])):this._items.splice(this._items.indexOf(t),1),!0):!1},n.prototype.clear=function(){this._items.forEach(this["delete"].bind(this)),this._items=[],this._stringItems={},this._unsubscribers={}},n.prototype.forEach=function(e){var t,n=0;for(t in this._stringItems)e(this._stringItems[t],n,this),n+=1;this._items.forEach(function(t){e(t,n,this),n+=1}.bind(this))},n.prototype.values=function(){var e=[];return this.forEach(function(t){e.push(t)}),e},n.prototype.keys=n.prototype.values,n.prototype.addMany=function(e){return e.forEach(this.add.bind(this)),this},n.prototype.intersection=function(e){var t=new n;return e.forEach(function(e){this.has(e)&&t.add(e)}.bind(this)),t},n.prototype.difference=function(e){var t=new n(this.values());return e.forEach(function(e){t.has(e)?t["delete"](e):t.add(e)}),t},n.prototype.size=function(){var e,t=this._items.length;for(e in this._stringItems)t+=1;return t},n}"function"==typeof using?using("MO5.CoreObject","MO5.types").define("MO5.Set",e):"undefined"!=typeof window?window.MO5.Set=e(MO5.CoreObject,MO5.types):module.exports=e(require("./CoreObject.js"),require("./types.js"))}(),using().define("MO5.Size",function(){function e(e,t){this.width=e||0,this.height=t||0}return e}),function(){function e(e,t,n,i){function s(t){e.call(this),this.message=t,this.name="MO5.TimerError"}function r(){t.call(this),this.running=!1,this.paused=!1,this.canceled=!1,this.startTime=+new Date,this.timeElapsed=0,this.pauseTimeElapsed=0,this.pauseStartTime=this.startTime}return s.prototype=new e,r.prototype=new t,r.prototype.constructor=r,r.prototype.start=function(){return this.startTime=+new Date,this.running=!0,this.trigger("started",null,!1),this},r.prototype.stop=function(){return this.running=!1,this.paused=!1,this.trigger("stopped",null,!1),this},r.prototype.cancel=function(){return this.running||n(new s("Trying to cancel a Timer that isn't running.")),this.elapsed(),this.canceled=!0,this.running=!1,this.paused=!1,this.trigger("canceled",null,!1),this},r.prototype.isRunning=function(){return this.running},r.prototype.isCanceled=function(){return this.canceled},r.prototype.isPaused=function(){return this.paused},r.prototype.pause=function(){this.paused=!0,this.pauseStartTime=+new Date,this.trigger("paused",null,!1)},r.prototype.resume=function(){this.paused||n(new s("Trying to resume a timer that isn't paused.")),this.paused=!1,this.pauseTimeElapsed+=+new Date-this.pauseStartTime,this.trigger("resumed",null,!1)},r.prototype.elapsed=function(){return this.running&&!this.paused&&(this.timeElapsed=+new Date-this.startTime-this.pauseTimeElapsed),this.timeElapsed},r.prototype.getReadOnlyCapability=function(){var e=this;return{isRunning:function(){return e.running},isCanceled:function(){return e.canceled},isPaused:function(){return e.paused},elapsed:function(){return e.elapsed()}}},r.prototype.promise=function(){var e=new i,t=this;return this.once(function(){e.resolve(t)},"stopped"),this.once(function(){e.reject(t)},"canceled"),this.once(function(){e.reject(t)},"destroyed"),e},r}"function"==typeof using?using("MO5.Exception","MO5.CoreObject","MO5.fail","MO5.Promise").define("MO5.Timer",e):"undefined"!=typeof window?window.MO5.Timer=e(MO5.Exception,MO5.CoreObject,MO5.fail,MO5.Promise):module.exports=e(require("./Exception.js"),require("./CoreObject.js"),require("./fail.js"),require("./Promise.js"))}(),function(){function e(e,t,n,i){function s(n){var i;if(t.call(this),n&&!(n instanceof Array))throw new e("Parameter 1 is expected to be of type Array.").log();n=n||[],i=this,this.timers={},this.count=0,n.forEach(function(e){i.addTimer(e)})}return s.prototype=new t,s.prototype.constructor=s,s.prototype.addTimer=function(t){var n,i=this;if(this.timers[+t])throw new e("A timer with ID '"+t+"' has already been added to the watcher.");return this.count+=1,n=function(){i.count-=1,i.count<1&&i.trigger("stopped",null,!1)},this.timers[+t]={timer:t,unsubscribe:function(){t.unsubscribe(n,"stopped")}},t.subscribe(n,"stopped"),this.trigger("added",t,!1),this},s.prototype.createTimer=function(){var e=new i;return this.trigger("created",e,!1),this.addTimer(e),e},s.prototype.removeTimer=function(t){return this.timers[+t]?(this.timers[+t].unsubscribe(),delete this.timers[+t],this.trigger("removed",t,!1),this):(n(new e("Trying to remove a timer that is unknown to the watcher.")),this)},s.prototype.forAll=function(e){var t,n;for(t in this.timers)this.timers.hasOwnProperty(t)&&(n=this.timers[t].timer,n instanceof s?this.timers[t].timer.forAll(e):this.timers[t].timer[e]());return this},s.prototype.cancel=function(){return this.forAll("cancel"),this.trigger("canceled",null,!1),this},s.prototype.pause=function(){return this.forAll("pause"),this.trigger("paused",null,!1),this},s.prototype.resume=function(){return this.forAll("resume"),this.trigger("resumed",null,!1),this},s.prototype.stop=function(){return this.forAll("stop")},s.prototype.start=function(){return this.forAll("start"),this.trigger("started",null,!1),this},s.prototype.promise=function(){return i.prototype.promise.call(this)},s}"function"==typeof using?using("MO5.Exception","MO5.CoreObject","MO5.fail","MO5.Timer").define("MO5.TimerWatcher",e):"undefined"!=typeof window?window.MO5.TimerWatcher=e(MO5.Exception,MO5.CoreObject,MO5.fail,MO5.Timer):module.exports=e(require("./Exception.js"),require("./CoreObject.js"),require("./fail.js"),require("./Timer.js"))}(),using().define("MO5.tools",function(){var e={};return e.getUniqueId=function(){var e=0;return function(){return e++}}(),e.getWindowDimensions=function(){var e=window,t="inner";return"innerWidth"in e||(t="client",e=document.documentElement||document.body),{width:e[t+"Width"],height:e[t+"Height"]}},e.fitToWindow=function(t,n,i){var s,r,o,a,u,c;s=e.getWindowDimensions(),o=s.width,a=s.height,u=o/n,c=a/i,r=u>c?c:u,t.setAttribute("style",t.getAttribute("style")+" -moz-transform: scale("+r+","+r+") rotate(0.01deg); -ms-transform: scale("+r+","+r+"); -o-transform: scale("+r+","+r+"); -webkit-transform: scale("+r+","+r+"); transform: scale("+r+","+r+");")},e.timeoutInspector=function(){var e,t,n,i,s,r={},o=0,a=0,u=0;return e=window.setTimeout,t=window.setInterval,n=window.clearTimeout,i=window.clearInterval,s=window.requestAnimationFrame,{logAnimationFrameRequests:!1,logTimeouts:!1,logIntervals:!1,enable:function(){window.setTimeout=function(t,n){var i=e(t,n);return o+=1,this.logTimeouts&&console.log("Setting timeout: ",{callback:t.toString(),time:n},i),i},window.setInterval=function(e,n){var i=t(e,n);return a+=1,r[i]=!0,this.logIntervals&&console.log("Setting interval: ",{callback:e.toString(),time:n},i),i},window.clearTimeout=function(e){return console.log("Clearing timeout: ",e),n(e)},window.clearInterval=function(e){return console.log("Clearing interval: ",e),e in r?delete r[e]:console.log("Warning: Interval "+e+" doesn't exist."),i(e)},window.requestAnimationFrame=function(e){return u+=1,this.logAnimationFrameRequests&&console.log("Requesting animation frame: ",{callback:e.toString()}),s(e)}},disable:function(){window.setTimeout=e,window.setInterval=t,window.clearTimeout=n,window.clearInterval=i,window.requestAnimationFrame=s},getActiveIntervals:function(){var e,t=[];for(e in this.activeIntervals)t.push(e);return t},totalTimeoutCalls:function(){return o},totalIntervalCalls:function(){return a},totalRequestAnimationFrameCalls:function(){return u}}}(),e}),using("MO5.Exception","MO5.Timer","MO5.easing").define("MO5.transform",function(e,t,n){function i(i,s,r,o){if(o=o||{},"undefined"==typeof i||!i)throw new e("MO5.transform expects parameter callback to be a function.");var a,u,c="undefined"!=typeof o.duration&&o.duration>=0?o.duration:500,l=s,d=o.timer||new t,h=r-s,p=o.log||!1,f=0,m=0,g=o.fps||60;return a=o.easing||n.sineEaseOut,u=function(){var e,t;if(Date.now()-m>1e3/g){if(d.canceled)return;if(d.paused)return void d.once(u,"resumed");if(f+=1,t=d.elapsed(),t>c||d.stopped)return l=s+h,i(r),void(d.stopped||d.stop());l=a(c,t)*h+s,i(l),e=d.elapsed()-t,p===!0&&console.log("Current value: "+l+"; c: "+f+"; Exec time: "+e),m=Date.now()}requestAnimationFrame(u)},d.start(),requestAnimationFrame(u),d}return i}),function(){function e(){var e={};return e.isObject=function(e){return"object"==typeof e&&null!==e},e.isString=function(e){return"string"==typeof e},e.isNumber=function(e){return"number"==typeof e},e.isFunction=function(e){return"function"==typeof e},e.isArray=function(t){return Array.isArray?Array.isArray(t):e.isObject(t)?t instanceof Array:!1},e.hasForEach=function(t){return e.isObject(t)&&e.isFunction(t.forEach)},e}"function"==typeof using?using().define("MO5.types",e):"undefined"!=typeof window?window.MO5.types=e():module.exports=e()}(),using("WSE.assets.Animation","WSE.assets.Audio","WSE.assets.Background","WSE.assets.Character","WSE.assets.Curtain","WSE.assets.Imagepack","WSE.assets.Textbox").define("WSE.assets",function(e,t,n,i,s,r,o){var a={Animation:e,Audio:t,Background:n,Character:i,Curtain:s,Imagepack:r,Textbox:o};return a}),using("WSE.commands.alert","WSE.commands.break","WSE.commands.choice","WSE.commands.confirm","WSE.commands.do","WSE.commands.fn","WSE.commands.global","WSE.commands.globalize","WSE.commands.goto","WSE.commands.line","WSE.commands.localize","WSE.commands.prompt","WSE.commands.restart","WSE.commands.set_vars","WSE.commands.sub","WSE.commands.trigger","WSE.commands.var","WSE.commands.wait","WSE.commands.while","WSE.commands.with").define("WSE.commands",function(e,t,n,i,s,r,o,a,u,c,l,d,h,p,f,m,g,y,b,v){"use strict";var w={alert:e,"break":t,choice:n,confirm:i,"do":s,fn:r,global:o,globalize:a,"goto":u,line:c,localize:l,prompt:d,restart:h,set_vars:p,sub:f,trigger:m,"var":g,wait:y,"while":b,"with":v};return w}),using().define("WSE.functions",function(){"use strict";var e={savegames:function(e){e.toggleSavegameMenu()},stageclick_disable:function(e){e.game.unsubscribeListeners()},stageclick_enable:function(e){e.game.subscribeListeners()}};return e}),using("WSE.dataSources.LocalStorage").define("WSE.dataSources",function(e){var t={LocalStorage:e};return t}),using("MO5.EventBus","WSE.assets","WSE.commands","WSE.dataSources","WSE.functions").define("WSE",function(e,t,n,i,s){
"use strict";var r={},o="2015.12.1-final.1512231127";return e.inject(r),r.dataSources=i,r.assets=t,r.commands=n,r.functions=s,r.getVersion=function(){return o},r}),using().define("WSE.Keys",function(){function e(e){e=e||{},this.keys={},this.keys.BACKSPACE={kc:8},this.keys.TAB={kc:9},this.keys.ENTER={kc:13,which:13},this.keys.SHIFT={kc:16},this.keys.CTRL={kc:17},this.keys.ALT={kc:18},this.keys.PAUSE={kc:19},this.keys.CAPS_LOCK={kc:20},this.keys.ESCAPE={kc:27},this.keys.SPACE={kc:32},this.keys.PAGE_UP={kc:33},this.keys.PAGE_DOWN={kc:20},this.keys.END={kc:20},this.keys.HOME={kc:20},this.keys.LEFT_ARROW={kc:37},this.keys.UP_ARROW={kc:38},this.keys.RIGHT_ARROW={kc:39},this.keys.DOWN_ARROW={kc:40},this.keys.INSERT={kc:45},this.keys.DELETE={kc:46},this.keys.NUM_0={kc:48},this.keys.NUM_1={kc:49},this.keys.NUM_2={kc:50},this.keys.NUM_3={kc:51},this.keys.NUM_4={kc:52},this.keys.NUM_5={kc:53},this.keys.NUM_6={kc:54},this.keys.NUM_7={kc:55},this.keys.NUM_8={kc:56},this.keys.NUM_9={kc:57},this.keys.A={kc:65},this.keys.B={kc:66},this.keys.C={kc:67},this.keys.D={kc:68},this.keys.E={kc:69},this.keys.F={kc:70},this.keys.G={kc:71},this.keys.H={kc:72},this.keys.I={kc:73},this.keys.J={kc:74},this.keys.K={kc:75},this.keys.L={kc:76},this.keys.M={kc:77},this.keys.N={kc:78},this.keys.O={kc:79},this.keys.P={kc:80},this.keys.Q={kc:81},this.keys.R={kc:82},this.keys.S={kc:83},this.keys.T={kc:84},this.keys.U={kc:85},this.keys.V={kc:86},this.keys.W={kc:87},this.keys.X={kc:88},this.keys.Y={kc:89},this.keys.Z={kc:90},this.keys.LEFT_WIN={kc:91},this.keys.RIGHT_WIN={kc:92},this.keys.SELECT={kc:93},this.keys.NUMPAD_0={kc:96},this.keys.NUMPAD_1={kc:97},this.keys.NUMPAD_2={kc:98},this.keys.NUMPAD_3={kc:99},this.keys.NUMPAD_4={kc:100},this.keys.NUMPAD_5={kc:101},this.keys.NUMPAD_6={kc:102},this.keys.NUMPAD_7={kc:103},this.keys.NUMPAD_8={kc:104},this.keys.NUMPAD_9={kc:105},this.keys.MULTIPLY={kc:106},this.keys.ADD={kc:107},this.keys.SUBSTRACT={kc:109},this.keys.DECIMAL_POINT={kc:110},this.keys.DIVIDE={kc:111},this.keys.F1={kc:112},this.keys.F2={kc:113},this.keys.F3={kc:114},this.keys.F4={kc:115},this.keys.F5={kc:116},this.keys.F6={kc:117},this.keys.F7={kc:118},this.keys.F8={kc:119},this.keys.F9={kc:120},this.keys.F10={kc:121},this.keys.F11={kc:122},this.keys.F12={kc:123},this.keys.NUM_LOCK={kc:144},this.keys.SCROLL_LOCK={kc:145},this.keys.SEMI_COLON={kc:186},this.keys.EQUALS={kc:187},this.keys.COMMA={kc:188},this.keys.DASH={kc:189},this.keys.PERIOD={kc:190},this.keys.SLASH={kc:191},this.keys.GRAVE={kc:192},this.keys.OPEN_BRACKET={kc:219},this.keys.BACK_SLASH={kc:220},this.keys.CLOSE_BRACKET={kc:221},this.keys.SINGLE_QUOTE={kc:222},this.listeners=[];var t,n,i,s,r,o,a=e.log||!1,u=e.element||window,c=this;t=function(e){null!=e&&"undefined"!=typeof e&&(e.addEventListener?(e.addEventListener("keyup",i,!1),e.addEventListener("keydown",s,!1),e.addEventListener("keypress",r,!1),a===!0&&(e.addEventListener("keyup",o,!1),e.addEventListener("keydown",o,!1),e.addEventListener("keypress",o,!1))):e.attachEvent&&(e.attachEvent("onkeyup",i),e.attachEvent("onkeydown",s),e.attachEvent("onkeypress",r),a===!0&&(e.attachEvent("onkeyup",o),e.attachEvent("onkeydown",o),e.attachEvent("onkeypress",o))))},n=function(e,t){var n,i,s,r,o=c.listeners.length;for(i=0;o>i;++i)n=c.listeners[i],"undefined"!=typeof n&&n.type==t&&(n.key=n.key||{},s=n.key.kc||null,r=n.key.which||null,(e.which==r||e.keyCode==s)&&n.callback(e))},i=function(e){n(e,"up")},s=function(e){n(e,"down")},r=function(e){n(e,"press")},o=function(e){console.log(e)},t(u)}return e.prototype.addListener=function(e,t,n){if(n=n||"up","up"!==n&&"down"!==n&&"press"!==n)throw new Error("Event type not recognized.");this.listeners.push({key:e,callback:t,type:n})},e.prototype.removeListener=function(e,t,n){var i,s=this.listeners.length;n=n||null;for(var r=0;s>r;++r)i=this.listeners[r],(null===n||i.type==n)&&"undefined"!=typeof i&&i.key===e&&i.callback===t&&delete this.listeners[r]},e.prototype.forAll=function(e,t){if(t=t||"up","up"!==t&&"down"!==t&&"press"!==t)throw new Error("Event type not recognized.");for(var n in this.keys)this.keys.hasOwnProperty(n)&&this.addListener(this.keys[n],e,t)},e}),using("MO5.Timer").define("WSE.tools",function(e){"use strict";var t={};return t.attachEventListener=function(e,t,n){null!==e&&"undefined"!=typeof e&&(e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n))},t.applyAssetUnits=function(e,t){var n,i;n=t.getAttribute("x")||"",i=t.getAttribute("y")||"",e.xUnit=n.replace(/^.*(px|%)$/,"$1"),e.xUnit=e.xUnit||"px",e.yUnit=i.replace(/^.*(px|%)$/,"$1"),e.yUnit=e.yUnit||"px","px"!==e.xUnit&&"%"!==e.xUnit&&(e.xUnit="px"),"px"!==e.yUnit&&"%"!==e.yUnit&&(e.yUnit="px")},t.removeEventListener=function(e,t,n){"undefined"!=typeof e&&null!==e&&e.removeEventListener(t,n,!1)},t.replaceVariables=function(e,t){var n,i;return null===e?e:("string"!=typeof e&&(t.bus.trigger("wse.interpreter.error",{message:"Argument supplied to the replaceVariables function must be a string."}),e=""),n=function(){var e=arguments[1];return t.globalVars.has(e)?""+t.globalVars.get(e):""},i=function(){var e=arguments[1];return e in t.runVars?""+t.runVars[e]:""},e=e.replace(/\{\$\$([a-zA-Z0-9_]+)\}/g,n),e=e.replace(/\{\$([a-zA-Z0-9_]+)\}/g,i))},t.getSerializedNodes=function(e){var t,n,i=new XMLSerializer,s=e.childNodes,r="";for(t=0,n=s.length;n>t;t+=1)r+=i.serializeToString(s[t]);return r},t.getParsedAttribute=function(e,n,i,s){var r;return arguments.length<3&&(s=""),r=e.getAttribute(n)||""+s,t.replaceVariables(r,i)},t.textToHtml=function(e,t){return t=t||!1,String.prototype.trim?e=e.trim():(e=e.replace(/^\n/,""),e=e.replace(/\n$/,"")),e=t===!0?e.replace(/\n/g,"<br />"):e,e=e.replace(/\{/g,"<"),e=e.replace(/\}/g,">")},t.getUniqueId=function(){var e=0;return function(){return e+=1}}(),t.firstLetterUppercase=function(e){return e.length<1?"":""+e.charAt(0).toUpperCase()+e.replace(/^.{1}/,"")},t.mixin=function(e,t){var n;for(n in e)e.hasOwnProperty(n)&&(t[n]=e[n])},t.extractUnit=function(e){return"string"!=typeof e?"":e.replace(/^(-){0,1}[0-9]*/,"")},t.calculateValueWithAnchor=function(e,n,i){var s=0,r="px";return n?(r=t.extractUnit(n),n=parseInt(n,10),s="%"===r?e-i/100*n:e-n):e},t.createTimer=function(t){var n=new e;return t=t||0,t=0>t?0:t,n.start(),setTimeout(n.stop.bind(n),t),n},t.getWindowDimensions=function(){var e=window,t="inner";return"innerWidth"in e||(t="client",e=document.documentElement||document.body),{width:e[t+"Width"],height:e[t+"Height"]}},t.fitToWindow=function(e,n,i){var s,r,o,a,u,c;s=t.getWindowDimensions(),o=s.width,a=s.height,u=o/n,c=a/i,r=u>c?c:u,e.setAttribute("style",e.getAttribute("style")+" -moz-transform: scale("+r+","+r+") rotate(0.01deg); -ms-transform: scale("+r+","+r+"); -o-transform: scale("+r+","+r+"); -webkit-transform: scale("+r+","+r+"); transform: scale("+r+","+r+");")},t.log=function(e,n){t.trigger(e,"wse.interpreter.message",n)},t.warn=function(e,n,i){t.trigger(e,"wse.interpreter.warning",n,i)},t.logError=function(e,n,i){t.trigger(e,"wse.interpreter.error",n,i)},t.trigger=function(e,t,n,i){e.trigger(t,{element:i||null,message:n})},t}),using("MO5.Map").define("WSE.dataSources.LocalStorage",function(e){"use strict";function t(){}var n,i="___wse_storage_test",s=!1;try{localStorage.setItem(i,"works"),"works"===localStorage.getItem(i)&&(s=!0)}catch(r){console.error("LocalStorage not available, using JS object as fallback."),n=new e}return t.prototype.set=function(e,t){s?localStorage.setItem(e,t):n.set(e,t)},t.prototype.get=function(e){return s?localStorage.getItem(e):n.has(e)?n.get(e):null},t.prototype.remove=function(e){if(!s){if(!n.has(e))return;return n.remove(e)}return localStorage.removeItem(e)},t}),using("WSE.commands","WSE.functions","WSE.tools::warn").define("WSE.Trigger",function(e,t,n){"use strict";function i(i,s){var r,o=this;if(this.name=i.getAttribute("name")||null,this.event=i.getAttribute("event")||null,this.special=i.getAttribute("special")||null,this.fnName=i.getAttribute("function")||null,this.scene=i.getAttribute("scene")||null,this.interpreter=s,this.isSubscribed=!1,null===this.name)return void n(s.bus,"No 'name' attribute specified on 'trigger' element.",i);if(null===this.event)return void n(s.bus,"No 'event' attribute specified on 'trigger' element '"+this.name+"'.",i);if(null===this.special&&null===this.fnName&&null===this.scene)return void n(s.bus,"No suitable action or function found for trigger element '"+this.name+"'.",i);if(this.scene&&(r=function(){console.log('Triggering event "'+o.event+'"...'),e.sub(i,s),s.index=0,s.currentElement=0,s.next()}),this.isKeyEvent=!1,this.key=null,null!==this.special&&"next"!==this.special)return void n(s.bus,"Unknown special specified on trigger element '"+this.name+"'.",i);if("next"===this.special&&(r=function(){"pause"===o.interpreter.state||o.interpreter.waitCounter>0||o.interpreter.next()}),null!==this.fnName){if("function"!=typeof t[this.fnName])return void n(s.bus,"Unknown function specified on trigger element '"+this.name+"'.",i);r=function(){t[o.fnName](o.interpreter,i)}}switch(this.event){case"keyup":case"keydown":case"keypress":return this.isKeyEvent=!0,this.key=i.getAttribute("key")||null,null===this.key?void n(s.bus,"No 'key' attribute specified on trigger element '"+this.name+"'.",i):"undefined"==typeof s.game.keys.keys[this.key]||null===s.game.keys.keys[this.key]?void n(s.bus,"Unknown key '"+this.key+"' specified on trigger element '"+this.name+"'.",i):void(this.fn=function(e){e.keys[o.key].kc===e.event.keyCode&&(s.keysDisabled>0||r())});default:this.fn=r}}return i.prototype.activate=function(){this.isSubscribed!==!0&&(this.interpreter.bus.subscribe(this.fn,this.event),this.isSubscribed=!0)},i.prototype.deactivate=function(){this.isSubscribed!==!1&&(this.interpreter.bus.unsubscribe(this.fn,this.event),this.isSubscribed=!1)},i}),using("MO5.EventBus","MO5.ajax","WSE.Keys","WSE.Interpreter","WSE.tools","WSE").define("WSE.Game",function(e,t,n,i,s,r){"use strict";function o(t){var s;r.trigger("wse.game.constructor",{args:t,game:this}),t=t||{},this.bus=new e,this.url=t.url||"game.xml",this.gameId=t.gameId||null,this.ws=null,this.debug=t.debug===!0?!0:!1,s=t.host||!1,this.host=s,this.gameId?(this.ws=(new DOMParser).parseFromString(document.getElementById(this.gameId).innerHTML,"application/xml"),console.log("this.ws:",this.ws),this.init()):s?(this.ws=function(e){var t,n;return n=new DOMParser,t=s.get(e),n.parseFromString(t,"application/xml")}(this.url),this.init()):this.load(),this.interpreter=new i(this),this.keys=new n,this.listenersSubscribed=!1,this.bus.subscribe(function(e){console.log("Message: "+e)},"wse.interpreter.message"),this.bus.subscribe(function(e){console.log("Error: "+e.message)},"wse.interpreter.error"),this.bus.subscribe(function(e){console.log("Warning: "+e.message,e.element)},"wse.interpreter.warning")}return o.prototype.load=function(){var e,n;n=this,e=function(e){n.ws=e.responseXML,n.init()},t("GET",this.url,null,e)},o.prototype.loadFromUrl=function(e){var n,i;this.url=e||this.url,i=this,n=function(e){i.ws=e.responseXML,i.init()},t("GET",this.url,null,n)},o.prototype.init=function(){var e,t,n,i,r,o,a,u,c,l;u=this,e=this.ws;try{n=e.getElementsByTagName("stage")}catch(d){console.log(d)}if(r="800px",o="480px",a="Stage",!n||n.length<1)throw new Error("No stage definition found!");i=n[0],r=i.getAttribute("width")||r,o=i.getAttribute("height")||o,a=i.getAttribute("id")||a,"yes"===i.getAttribute("create")?(t=document.createElement("div"),t.setAttribute("id",a),document.body.appendChild(t)):t=document.getElementById(a),t.setAttribute("class","WSEStage"),t.style.width=r,t.style.height=o,c=function(){var e=s.getWindowDimensions();t.style.left=e.width/2-parseInt(r,10)/2+"px",t.style.top=e.height/2-parseInt(o,10)/2+"px"},"yes"===i.getAttribute("center")&&(s.attachEventListener(window,"resize",c),c()),l=function(){console.log("Resizing..."),s.fitToWindow(t,parseInt(r,10),parseInt(o,10))},"yes"===i.getAttribute("resize")&&(s.attachEventListener(window,"resize",l),l()),this.stage=t,this.applySettings(),this.host&&(this.host.window.width=parseInt(r,10),this.host.window.height=parseInt(o,10),function(e){var n="true"===e.getSetting("host.stage.resize")?!0:!1;n&&window.addEventListener("resize",function(){console.log("Resizing..."),s.fitToWindow(t,parseInt(r,10),parseInt(o,10))})}(this))},o.prototype.getSetting=function(e){var t,n,i,s,r,o;for(n=this.ws.getElementsByTagName("setting"),i=0,s=n.length;s>i;i+=1)if(r=n[i],o=r.getAttribute("name")||null,null!==o&&o===e)return t=r.getAttribute("value")||null;return null},o.prototype.applySettings=function(){this.webInspectorEnabled="true"===this.getSetting("host.inspector.enable")?!0:!1,this.host&&this.webInspectorEnabled===!0&&this.host.inspector.show()},o.prototype.start=function(){var e,t,n;return n=this,null===this.ws?setTimeout(function(){n.start()}):(e=function(){"pause"===n.interpreter.state||n.interpreter.waitCounter>0||n.interpreter.next(!0)},t=function(e){return n.bus.trigger("contextmenu",{}),e&&"function"==typeof e.preventDefault&&e.preventDefault(),!1},this.subscribeListeners=function(){s.attachEventListener(this.stage,"contextmenu",t),s.attachEventListener(this.stage,"click",e),this.listenersSubscribed=!0},this.unsubscribeListeners=function(){s.removeEventListener(this.stage,"contextmenu",t),s.removeEventListener(this.stage,"click",e),this.listenersSubscribed=!1},void this.interpreter.start())},o}),using("MO5.transform","WSE.dataSources.LocalStorage","WSE.Trigger","WSE.tools","WSE.tools.ui","WSE","WSE.tools::logError","WSE.tools::warn","WSE.LoadingScreen","WSE.tools::getSerializedNodes").define("WSE.Interpreter",function(e,t,n,i,s,r,o,a,u,c){"use strict";function l(e){var n,i;r.trigger("wse.interpreter.constructor",{game:e,interpreter:this}),this.game=e,this.assets={},this.index=0,this.visitedScenes=[],this.log=[],this.waitForTimer=!1,this.assetsLoading=0,this.assetsLoadingMax=0,this.assetsLoaded=0,this.startTime=0,this.runVars={},this.callStack=[],this.keysDisabled=0,this.state="listen",this.waitCounter=0,this.debug=e.debug===!0?!0:!1,n=new t,this.datasource=n,i="wse_globals_"+location.pathname+"_"+this.game.url+"_",this.globalVars={set:function(e,t){n.set(i+e,t)},get:function(e){return n.get(i+e)},has:function(e){return null===n.get(i+e)?!1:!0}},this._loadingScreen=new u,this.debug===!0&&(this.game.bus.debug=!0)}return l.prototype.start=function(){var e,t,n,i,s=Date.now();this.story=this.game.ws,this.stage=this.game.stage,this.bus=this.game.bus,this.index=0,this.currentElement=0,this.sceneId=null,this.scenePath=[],this.currentCommands=[],this.wait=!1,this.startTime=Math.round(+new Date/1e3),this.stopped=!1,e=this,i=this.bus,this._startLoadingScreen(),t=function(t){var n,i,s;if(t=t||{},i=t.element||null,n=null,null!==i)try{n="asset"===t.element.tagName?"assets":null,n="settings"===t.element.parent.tagName?"settings":null}catch(r){}switch(n=n||"scenes"){case"assets":s="         Encountered in section 'assets'.";break;case"settings":s="         Encountered in section 'settings'.";break;default:s="         Encountered in scene '"+e.sceneId+"', element "+e.currentElement+"."}console.log(s)},i.subscribe(t,"wse.interpreter.error"),i.subscribe(t,"wse.interpreter.warning"),i.subscribe(t,"wse.interpreter.message"),i.subscribe(function(){console.log("Game over.")},"wse.interpreter.end"),i.subscribe(function(){e.numberOfFunctionsToWaitFor+=1},"wse.interpreter.numberOfFunctionsToWaitFor.increase"),i.subscribe(function(){e.numberOfFunctionsToWaitFor-=1},"wse.interpreter.numberOfFunctionsToWaitFor.decrease"),i.subscribe(this._loadingScreen.addItem.bind(this._loadingScreen),"wse.assets.loading.increase"),i.subscribe(this._loadingScreen.itemLoaded.bind(this._loadingScreen),"wse.assets.loading.decrease"),this.buildAssets(),this.createTriggers(),n=function(t){return function(n){i.trigger(t,{event:n,keys:e.game.keys.keys})}},this.game.keys.forAll(n("keyup"),"up"),this.game.keys.forAll(n("keydown"),"down"),this.game.keys.forAll(n("keypress"),"press"),this.game.subscribeListeners(),this._assetsLoaded=!1,this._loadingScreen.subscribe("finished",function(){var t=Date.now()-s;e._assetsLoaded||(e._assetsLoaded=!0,1e3>t?setTimeout(e.runStory.bind(e),1e3-t):e.runStory())}),this._loadingScreen.count()<1&&(this._assetsLoaded=!0,this.runStory())},l.prototype.runStory=function(){var e;return e=this,this.assetsLoading>0?void function(){var t;t=function(){e.runStory()},setTimeout(t,100)}():(this.bus.trigger("wse.assets.loading.finished"),this._loadingScreen.hide(),this.startTime=Math.round(+new Date/1e3),void this.changeScene(this.getFirstScene()))},l.prototype.getFirstScene=function(){var e,t,n;return e=this.story.getElementsByTagName("scene"),this.scenes=e,t=e.length,n=this.getSceneById("start"),null!==n?n:1>t?(o(this.bus,"No scenes found!"),null):e[0]},l.prototype.changeScene=function(e){this.changeSceneNoNext(e),this.next()},l.prototype.changeSceneNoNext=function(e){var t,n,i=this.bus;if(i.trigger("wse.interpreter.changescene.before",{scene:e,interpreter:this},!1),"undefined"==typeof e||null===e)return void o(i,"Scene does not exist.");if(n=e.getAttribute("id"),this.visitedScenes.push(n),null===n)return void o(i,"Encountered scene without id attribute.");for(i.trigger("wse.interpreter.message","Entering scene '"+n+"'.");this.scenePath.length>0;)this.popFromCallStack();return this.currentCommands=e.childNodes,t=this.currentCommands.length,this.index=0,this.sceneId=n,this.scenePath=[],this.currentElement=0,1>t?void a(i,"Scene '"+n+"' is empty.",e):(this.numberOfFunctionsToWaitFor=0,void i.trigger("wse.interpreter.changescene.after",{scene:e,interpreter:this},!1))},l.prototype.pushToCallStack=function(){var e={};e.index=this.index,e.sceneId=this.sceneId,e.scenePath=this.scenePath.slice(),e.currentElement=this.currentElement,this.callStack.push(e)},l.prototype.popFromCallStack=function(){var e=this.callStack.pop(),t=e.scenePath.slice();for(this.bus.trigger("wse.interpreter.message","Returning from sub scene '"+this.sceneId+"' to scene '"+e.sceneId+"'...",!1),this.index=e.index+1,this.sceneId=e.sceneId,this.scenePath=e.scenePath,this.currentScene=this.getSceneById(e.sceneId),this.currentElement=e.currentElement,this.currentCommands=this.currentScene.childNodes;t.length>0;)this.currentCommands=this.currentCommands[t.shift()].childNodes},l.prototype.getSceneById=function(e){var t,n,i,s;for(s=null,t=0,n=this.scenes.length;n>t;t+=1)if(i=this.scenes[t],i.getAttribute("id")===e){s=i;break}return null===s&&a(this.bus,"Scene '"+e+"' not found!"),s},l.prototype.next=function(e){var t,n,i,s,r,o=this.bus;if(r={stop:!1},e=e===!0?!0:!1,o.trigger("wse.interpreter.next.before",this,!1),e===!0&&o.trigger("wse.interpreter.next.user",r,!1),r.stop!==!0&&(s=this,"pause"!==this.state)){if(this.waitForTimer===!0||this.wait===!0&&this.waitCounter>0)return void setTimeout(function(){s.next()},0);if(this.wait===!0&&this.numberOfFunctionsToWaitFor<1&&(this.wait=!1),this.stopped=!1,this.index>=this.currentCommands.length)return this.callStack.length>0?(this.popFromCallStack(),void setTimeout(function(){s.next()},0)):(o.trigger("wse.interpreter.next.after.end",this,!1),void o.trigger("wse.interpreter.end",this));if(n=this.currentCommands[this.index],t=n.nodeName,"#text"===t||"#comment"===t)return this.index+=1,setTimeout(function(){s.next()},0),void o.trigger("wse.interpreter.next.ignore",this,!1);if(o.trigger("wse.interpreter.next.command",n),this.currentElement+=1,i=this.runCommand(this.currentCommands[this.index]),i=i||{},i.doNext=i.doNext===!1?!1:!0,i.wait=i.wait===!0?!0:!1,i.changeScene=i.changeScene||null,i.wait===!0&&(this.wait=!0),this.index+=1,null!==i.changeScene)return void this.changeScene(i.changeScene);if(i.doNext===!0)return setTimeout(function(){s.next()},0),void o.trigger("wse.interpreter.next.after.donext",this,!1);this.stopped=!0,o.trigger("wse.interpreter.next.after.nonext",this,!1)}},l.prototype.checkIfvar=function(e){var t,n,i,s,r=this.bus;if(t=e.getAttribute("ifvar")||null,n=e.getAttribute("ifvalue"),i=e.getAttribute("ifnot"),null!==t||null!==n||null!==i){if(s=this.runVars,!(t in s))return a(r,"Unknown variable '"+t+"' used in condition. Ignoring command.",e),r.trigger("wse.interpreter.runcommand.after.condition.error.key",{interpreter:this,command:e},!1),!1;if(null!==i&&""+s[t]==""+i)return r.trigger("wse.interpreter.message","Conidition not met. "+t+"=="+i),r.trigger("wse.interpreter.runcommand.after.condition.false",{interpreter:this,command:e},!1),!1;if(null!==n&&""+s[t]!=""+n)return r.trigger("wse.interpreter.message","Conidition not met."),r.trigger("wse.interpreter.runcommand.after.condition.false",{interpreter:this,command:e},!1),!1;r.trigger("wse.interpreter.runcommand.condition.met",{interpreter:this,command:e},!1),r.trigger("wse.interpreter.message","Conidition met.")}return!0},l.prototype.runCommand=function(e){var t,n,i=this.bus;return this.bus.trigger("wse.interpreter.runcommand.before",{interpreter:this,command:e},!1),t=e.tagName,n=e.getAttribute("asset")||null,this.checkIfvar(e)?t in r.commands?(i.trigger("wse.interpreter.runcommand.after.command",{interpreter:this,command:e},!1),i.trigger("game.commands."+t),r.commands[t](e,this)):null!==n&&n in this.assets&&"function"==typeof this.assets[n][t]&&t.match(/(show|hide|clear|flicker|flash|play|start|stop|pause|move|shake|set)/)?(i.trigger("game.assets."+n+"."+t),this.assets[n][t](e,this)):(a(i,"Unknown element '"+t+"'.",e),i.trigger("wse.interpreter.runcommand.after.error",{interpreter:this,command:e},!1),{doNext:!0}):{doNext:!0}},l.prototype.createTriggers=function(){var e,t,i,s,r,o,u,c=this.bus;c.trigger("wse.interpreter.triggers.create",this,!1),o=this,this.triggers={};try{e=this.game.ws.getElementsByTagName("triggers")[0].getElementsByTagName("trigger")}catch(l){return void console.log(l)}for(t=0,i=e.length;i>t;t+=1)s=e[t],r=s.getAttribute("name")||null,null!==r?"undefined"==typeof this.triggers[r]||null===this.triggers[r]?(u=new n(s,this),"function"==typeof u.fn&&(this.triggers[r]=u)):a(c,"A trigger with the name '"+r+"' already exists.",s):a(c,"No name specified for trigger.",s)},l.prototype.buildAssets=function(){var e,t,n,i,s=this.bus;s.trigger("wse.assets.loading.started");try{e=this.story.getElementsByTagName("assets")[0].childNodes}catch(r){o(s,"Error while creating assets: "+r.getMessage())}for(t=e.length,n=0;t>n;n+=1)i=e[n],1===i.nodeType&&this.createAsset(i)},l.prototype.createAsset=function(e){var t,n,s,u=this.bus;return u.trigger("wse.interpreter.createasset",{interpreter:this,asset:e},!1),t=e.getAttribute("name"),n=e.tagName,s=this,null===t?void o(u,"Expected attribute 'name'.",e):null===n?void a(u,"Expected attribute 'type' on asset '"+t+"'.",e):("undefined"!=typeof this.assets[t]&&a(u,"Trying to override existing asset '"+t+"'.",e),n=i.firstLetterUppercase(n),n in r.assets?void(this.assets[t]=new r.assets[n](e,this)):void a(u,"Unknown asset type '"+n+"'.",e))},l.prototype.createSaveGame=function(){var e,t,n;n={},e=this.assets;for(t in e)if(e.hasOwnProperty(t))try{n[t]=e[t].save()}catch(i){console.log("WSE Internal Error: Asset '"+t+"' does not have a 'save' method!")}return n},l.prototype.restoreSaveGame=function(e){var t,n;t=this.assets;for(n in t)if(t.hasOwnProperty(n))try{t[n].restore(e[n])}catch(i){console.log(i),a(this.bus,"Could not restore asset state for asset '"+n+"'!")}},l.prototype.save=function(e){e=e||"no name";var t,n,i,s,r,o,u=this.bus;t={},u.trigger("wse.interpreter.save.before",{interpreter:this,savegame:t},!1),t.saves=this.createSaveGame(),t.startTime=this.startTime,t.saveTime=Math.round(+new Date/1e3),t.screenContents=this.stage.innerHTML,t.runVars=this.runVars,t.name=e,t.log=this.log,t.visitedScenes=this.visitedScenes,t.gameUrl=this.game.url,t.index=this.index,t.wait=this.wait,t.waitForTimer=this.waitForTimer,t.currentElement=this.currentElement,t.sceneId=this.sceneId,t.scenePath=this.scenePath,t.listenersSubscribed=this.game.listenersSubscribed,t.callStack=this.callStack,t.waitCounter=this.waitCounter,t.pathname=location.pathname,i=this.buildSavegameId(e),n=JSON.stringify(t),r="wse_"+t.pathname+"_"+t.gameUrl+"_savegames_list",s=JSON.parse(this.datasource.get(r)),s=s||[],o=s.indexOf(i),o>=0&&s.splice(o,1),s.push(i);try{this.datasource.set(i,n),this.datasource.set(r,JSON.stringify(s))}catch(c){return a(u,"Savegame could not be created!"),u.trigger("wse.interpreter.save.after.error",{interpreter:this,savegame:t},!1),!1}return u.trigger("wse.interpreter.save.after.success",{interpreter:this,savegame:t}),!0},l.prototype.getSavegameList=function(e){var t,n,i,s,r,o;if(n="wse_"+location.pathname+"_"+this.game.url+"_savegames_list",t=this.datasource.get(n),null===t)return[];for(i=JSON.parse(t),o=[],s=0,r=i.length;r>s;s+=1)e===!0?o.unshift(JSON.parse(this.datasource.get(i[s]))):o.push(JSON.parse(this.datasource.get(i[s])));return this.bus.trigger("wse.interpreter.getsavegamelist",{interpreter:this,list:o,names:i},!1),o},l.prototype.buildSavegameId=function(e){var t={};return t.name=e,t.id="wse_"+location.pathname+"_"+this.game.url+"_savegame_"+e,this.bus.trigger("wse.interpreter.save.before",{interpreter:this,vars:t},!1),t.id},l.prototype.load=function(e){var t,n,i,s,r,o,u,c,l,d,h=this.bus;if(l=this,d=this.buildSavegameId(e),t=this.datasource,n=t.get(d),h.trigger("wse.interpreter.load.before",{interpreter:this,savegame:n},!1),!n)return a(h,"Could not load savegame '"+d+"'!"),!1;for(n=JSON.parse(n),this.stage.innerHTML=n.screenContents,this.restoreSaveGame(n.saves),this.startTime=n.startTime,this.runVars=n.runVars,this.log=n.log,this.visitedScenes=n.visitedScenes,this.index=n.index,this.wait=n.wait,this.waitForTimer=n.waitForTimer,this.currentElement=n.currentElement,this.callStack=n.callStack,this.waitCounter=n.waitCounter,this.state="listen",s=n.sceneId,this.sceneId=s,o=this.story.getElementsByTagName("scene"),this.scenes=o,u=0,c=this.scenes.length;c>u;u+=1)if(o[u].getAttribute("id")===s){i=o[u];break}if(!i)return h.trigger("wse.interpreter.error",{message:"Loading savegame '"+d+"' failed: Scene not found!"}),!1;for(r=n.scenePath,this.scenePath=r.slice(),this.currentCommands=i.childNodes;r.length>0;)this.currentCommands=this.currentCommands[r.shift()].childNodes;return function(e){var t,n,i,s,r,o,u,c;for(t=e.stage.getElementsByTagName("*"),n=0,i=t.length;i>n;n+=1)s=t[n],"undefined"!=typeof s&&null!==s&&(o=s.getAttribute("data-wse-type")||"",c="true"===s.getAttribute("data-wse-remove")?!0:!1,c===!0&&e.stage.removeChild(s),"choice"===o&&(r=parseInt(s.getAttribute("data-wse-index"),10)||null,null!==r?(u=e.currentCommands[r],"#text"!==u.nodeName&&"#comment"!==u.nodeName&&(e.stage.removeChild(s),e.commands.choice(u,e),e.waitCounter-=1)):a(e.bus,"No data-wse-index found on element.")))}(this),h.trigger("wse.interpreter.load.after",{interpreter:this,savegame:n},!1),!0},l.prototype.deleteSavegame=function(e){var t,n,i,s,r;return n="wse_"+location.pathname+"_"+this.game.url+"_savegames_list",s=this.datasource.get(n),null===s?!1:(t=JSON.parse(s),r=this.buildSavegameId(e),i=t.indexOf(r),i>=0?(t.splice(i,1),this.datasource.set("wse_"+location.pathname+"_"+this.game.url+"_savegames_list",JSON.stringify(t)),this.datasource.remove(r),!0):!1)},l.prototype.toggleSavegameMenu=function(){var e,t,n,i,r,o,a,u,c,l,d,h,p,f,m,g,y,b;if(r=this,d="WSESaveGameMenu_"+this.game.url,g=this.game.listenersSubscribed,e=document.getElementById(d)||null,null!==e){try{g="true"===e.getAttribute("data-wse-listener-status")?!0:!1,this.stage.removeChild(e)}catch(v){console.log(v)}return g===!0&&(this.savegameMenuVisible=!1),this.state=this.oldStateInSavegameMenu,void(this.waitCounter-=1)}if(this.stopped!==!0)return void setTimeout(function(){r.toggleSavegameMenu()},20);for(b=this.state,this.oldStateInSavegameMenu=b,this.state="pause",this.waitCounter+=1,this.savegameMenuVisible=!0,e=document.createElement("div"),e.innerHTML="",e.setAttribute("id",d),e.setAttribute("class","WSESavegameMenu"),e.setAttribute("data-wse-remove","true"),e.setAttribute("data-wse-listener-status",g),e.style.zIndex=1e5,e.style.position="absolute",o=this.getSavegameList(!0),t=document.createElement("input"),t.setAttribute("class","button delete"),t.setAttribute("type","button"),t.value="Delete",t.addEventListener("click",function(t){var n,i,o;t.stopPropagation(),t.preventDefault(),n=e.querySelector(".active")||null,null!==n&&(i=n.getAttribute("data-wse-savegame-name"),o=function(e){e!==!1&&(r.deleteSavegame(i),r.toggleSavegameMenu(),r.toggleSavegameMenu())},s.confirm(r,{title:"Delete game?",message:"Do you really want to delete savegame '"+i+"'?",callback:o}))},!1),i=document.createElement("input"),i.setAttribute("class","button save"),i.setAttribute("type","button"),i.value="Save",i.addEventListener("click",function(t){var n,i;return t.stopPropagation(),t.preventDefault(),n=e.querySelector(".active")||null,null===n?void s.prompt(r,{title:"New savegame",message:"Please enter a name for the savegame:",callback:function(e){if(null!==e){if(!e)return void s.alert(r,{title:"Error",message:"The savegame name cannot be empty!"});r.toggleSavegameMenu(),r.game.listenersSubscribed=g,r.save(e),r.toggleSavegameMenu(),r.game.listenersSubscribed=!1,s.alert(r,{title:"Game saved",message:"Your game has been saved."})}}}):(i=n.getAttribute("data-wse-savegame-name"),void s.confirm(r,{title:"Overwrite savegame?",message:"You are about to overwrite an old savegame. Are you sure?",trueText:"Yes",falseText:"No",callback:function(e){e!==!1&&(r.toggleSavegameMenu(),r.save(i),r.toggleSavegameMenu(),s.alert(r,{title:"Game saved",message:"Your game has been saved."}))}}))},!1),n=document.createElement("input"),n.setAttribute("class","button load"),n.setAttribute("type","button"),n.setAttribute("tabindex",1),n.value="Load",n.addEventListener("click",function(t){var n,i,o;t.stopPropagation(),t.preventDefault(),n=e.querySelector(".active")||null,null!==n&&(i=n.getAttribute("data-wse-savegame-name"),o=function(e){e!==!1&&(r.stage.removeChild(document.getElementById(d)),r.savegameMenuVisible=!1,r.waitCounter-=1,r.state=b,r.load(i))},s.confirm(r,{title:"Load game?",message:"Loading a savegame will discard all unsaved progress. Continue?",callback:o}))},!1),c=document.createElement("div"),c.setAttribute("class","panel"),l=document.createElement("input"),l.setAttribute("class","button resume"),l.setAttribute("type","button"),l.value="Resume",l.addEventListener("click",function(e){e.stopPropagation(),e.preventDefault(),r.stage.removeChild(document.getElementById(d)),r.bus.trigger("wse.interpreter.numberOfFunctionsToWaitFor.decrease",null,!1),r.savegameMenuVisible=!1,r.waitCounter-=1,r.state=b},!1),h=document.createElement("div"),h.setAttribute("class","list"),c.appendChild(n),c.appendChild(i),c.appendChild(t),c.appendChild(l),e.appendChild(c),m=function(e){return function(t){var i;t.stopPropagation(),t.preventDefault();try{i=h.querySelector(".active")||null,null!==i&&i.setAttribute("class",i.getAttribute("class").replace(/active/,""))}catch(s){console.log(s)}e.setAttribute("class",e.getAttribute("class")+" active"),n.focus()}},f=document.createElement("div"),f.setAttribute("class","button"),a=0,u=o.length;u>a;a+=1)p=o[a],f=document.createElement("div"),y=p.saveTime-p.startTime,f.setAttribute("class","button"),f.setAttribute("data-wse-savegame-name",p.name),f.innerHTML='<p class="name">'+p.name+'</p><p class="description"><span class="elapsed">'+parseInt(y/60/60,10)+"h "+parseInt(y/60%60,10)+"m "+parseInt(y%60,10)+'s</span><span class="date">'+new Date(1e3*p.saveTime).toUTCString()+"</span></p>",f.addEventListener("click",m(f,p),!1),h.appendChild(f);e.addEventListener("click",function(t){var n;t.stopPropagation(),t.preventDefault(),n=e.querySelector(".active")||null,null!==n&&n.setAttribute("class",n.getAttribute("class").replace(/active/,""))},!1),e.appendChild(h),this.stage.appendChild(e)},l.prototype._startLoadingScreen=function(){var e=this.story.querySelector("loadingScreen");e&&this._loadingScreen.setTemplate(c(e)),this._loadingScreen.show(this.stage)},
l}),using("MO5.transform","MO5.CoreObject").define("WSE.LoadingScreen",function(e,t){function n(){t.call(this),this._loading=0,this._loaded=0,this._max=0,this._finished=!1,this._template='<div class="container"><div class="logo"><img src="assets/images/logo.png"onerror="this.style.display=\'none\'"/></div><div class="heading"><span id="WSELoadingScreenPercentage">{$progress}%</span>Loading...</div><div class="progressBar"><div class="progress" id="WSELoadingScreenProgress" style="width: {$progress}%;"></div></div></div>',this._container=document.createElement("div"),this._container.setAttribute("id","WSELoadingScreen"),this._container.style.zIndex=1e4,this._container.style.width="100%",this._container.style.height="100%"}function i(e,t){for(var n in t)e=s(e,n,t[n]);return e}function s(e,t,n){return(""+e).split("{$"+t+"}").join(""+n)}return n.prototype=new t,n.prototype.setTemplate=function(e){this._template=e},n.prototype.addItem=function(){this._finished||(console.log("LoadingScreen: new item loading..."),this._loading+=1,this._max+=1,this.update())},n.prototype.count=function(){return this._max},n.prototype.itemLoaded=function(){this._finished||(console.log("LoadingScreen: item loaded."),this._loaded!==this._max&&(this._loading-=1,this._loaded+=1,this._loaded===this._max&&(this._finished=!0,this.trigger("finished")),this.update()))},n.prototype.update=function(){var e;this._loaded>this._max&&(this._loaded=this._max),e=parseInt(this._loaded/this._max*100,10),this._max<1&&(e=0),this._container.innerHTML=i(this._template,{all:this._max,remaining:this._max-this._loaded,loaded:this._loaded,progress:e})},n.prototype.show=function(e){this._container.style.display="",e.appendChild(this._container),this.update()},n.prototype.hide=function(){function t(e){i._container.style.opacity=e}function n(){i._container.style.display="none",i._container.parentNode.removeChild(i._container)}var i=this;e(t,1,0,{duration:500,onFinish:n}),this._container.style.display="none"},n}),using("WSE.tools::warn","WSE.tools::replaceVariables").define("WSE.tools.ui",function(e,t){"use strict";var n=13,i=27,s={confirm:function(e,t){var n,i,s,r,o,a,u,c,l,d,h,p,f,m,g;e.waitCounter+=1,t=t||{},n=t.title||"Confirm?",i=t.message||"Do you want to proceed?",s=t.trueText||"Yes",r=t.falseText||"No",o="function"==typeof t.callback?t.callback:function(){},a=t.parent||e.stage,f=t.pause===!0?!0:!1,m=e.state,g=t.doNext===!0?!0:!1,f===!0&&(e.state="pause"),p=document.createElement("div"),p.setAttribute("class","WSEUIContainer"),p.setAttribute("data-wse-remove","true"),u=document.createElement("div"),u.setAttribute("class","WSEUIDialog WSEUIConfirm"),c=document.createElement("div"),c.innerHTML=n,c.setAttribute("class","title"),l=document.createElement("div"),l.innerHTML=i,l.setAttribute("class","message"),d=document.createElement("input"),d.setAttribute("value",s),d.value=s,d.setAttribute("class","true button"),d.setAttribute("type","button"),d.addEventListener("click",function(t){t.stopPropagation(),t.preventDefault(),a.removeChild(p),e.waitCounter-=1,f===!0&&(e.state=m),o(!0),g===!0&&setTimeout(function(){e.next()},0)}),h=document.createElement("input"),h.setAttribute("value",r),h.value=r,h.setAttribute("class","false button"),h.setAttribute("type","button"),h.addEventListener("click",function(t){t.stopPropagation(),t.preventDefault(),a.removeChild(p),e.waitCounter-=1,f===!0&&(e.state=m),o(!1),g===!0&&setTimeout(function(){e.next()},0)}),u.appendChild(c),u.appendChild(l),u.appendChild(d),u.appendChild(h),p.appendChild(u),a.appendChild(p),d.focus()},alert:function(e,t){var n,i,s,r,o,a,u,c,l,d,h,p,f;e.waitCounter+=1,t=t||{},n=t.title||"Alert!",i=t.message||"Please take notice of this!",s=t.okText||"OK",r="function"==typeof t.callback?t.callback:function(){},o=t.parent||e.stage,h=t.pause===!0?!0:!1,p=e.state,f=t.doNext===!0?!0:!1,h===!0&&(e.state="pause"),d=document.createElement("div"),d.setAttribute("class","WSEUIContainer"),d.setAttribute("data-wse-remove","true"),a=document.createElement("div"),a.setAttribute("class","WSEUIDialog WSEUIConfirm"),u=document.createElement("div"),u.innerHTML=n,u.setAttribute("class","title"),c=document.createElement("div"),c.innerHTML=i,c.setAttribute("class","message"),l=document.createElement("input"),l.setAttribute("value",s),l.value=s,l.setAttribute("class","true button"),l.setAttribute("type","button"),l.addEventListener("click",function(t){t.stopPropagation(),t.preventDefault(),o.removeChild(d),e.waitCounter-=1,h===!0&&(e.state=p),r(!0),f===!0&&setTimeout(function(){e.next()},0)}),a.appendChild(u),a.appendChild(c),a.appendChild(l),d.appendChild(a),o.appendChild(d),l.focus()},prompt:function(e,t){var s,r,o,a,u,c,l,d,h,p,f,m,g,y,b,v,w,E,S;e.waitCounter+=1,t=t||{},s=t.title||"Input required",r=t.message||"Please enter something:",o=t.submitText||"Submit",a=t.cancelText||"Cancel",u="function"==typeof t.callback?t.callback:function(){},c=t.parent||e.stage,b=t.pause===!0?!0:!1,d=e.state,v=t.doNext===!0?!0:!1,w=t.allowEmptyInput,E=t.hideCancelButton,S=t.prefill||"",b===!0&&(e.state="pause"),y=document.createElement("div"),y.setAttribute("class","WSEUIContainer"),y.setAttribute("data-wse-remove","true"),l=document.createElement("div"),l.setAttribute("class","WSEUIDialog WSEUIPrompt"),h=document.createElement("div"),h.innerHTML=s,h.setAttribute("class","title"),p=document.createElement("div"),p.innerHTML=r,p.setAttribute("class","message"),g=document.createElement("input"),g.setAttribute("value",S),g.value=S,g.setAttribute("class","input text"),g.setAttribute("type","text"),g.addEventListener("keyup",function(e){function t(){e.keyCode===n&&f.click()}function s(){return e.keyCode!==i||E?!1:(m.click(),!0)}if(!s())return w?void t():void(g.value?(f.disabled=!1,t()):f.disabled=!0)}),f=document.createElement("input"),f.setAttribute("value",o),f.value=o,f.setAttribute("class","submit button"),f.setAttribute("type","button"),w||S||(f.disabled=!0),f.addEventListener("click",function(t){var n=g.value;(w||n)&&(t.stopPropagation(),t.preventDefault(),c.removeChild(y),e.waitCounter-=1,b===!0&&(e.state=d),u(n),v===!0&&setTimeout(function(){e.next()},0))}),m=document.createElement("input"),m.setAttribute("value",a),m.value=a,m.setAttribute("class","cancel button"),m.setAttribute("type","button"),m.addEventListener("click",function(t){t.stopPropagation(),t.preventDefault(),c.removeChild(y),e.waitCounter-=1,b===!0&&(e.state=d),u(null),v===!0&&setTimeout(function(){e.next()},0)}),l.appendChild(h),l.appendChild(p),l.appendChild(g),l.appendChild(f),E||l.appendChild(m),y.appendChild(l),c.appendChild(y),g.focus()}};return s.makeInputFn=function(n){return function(i,r){var o,a,u,c,l,d,h,p,f,m;return o=i.getAttribute("title")||"Input required...",a=i.getAttribute("message")||"Your input is required:",c=i.getAttribute("var")||null,p=i.getAttribute("submitText")||"",f=i.getAttribute("cancelText")||"",m=i.getAttribute("prefill")||"",h="no"===t(i.getAttribute("allowEmptyInput")||"",r)?!1:!0,d="yes"===t(i.getAttribute("hideCancelButton")||"",r)?!0:!1,l="false"===t(i.getAttribute("next")||"",r)?!1:!0,null!==c&&(c=t(c,r)),o=t(o,r),a=t(a,r),f=t(f,r),p=t(p,r),m=t(m,r),r.bus.trigger("wse.interpreter.commands."+n,i),null===c?(e(r.bus,"No 'var' attribute defined on "+n+" command. Command ignored.",i),{doNext:!0}):(u=r.runVars,s[n](r,{title:o,message:a,pause:!0,doNext:l,callback:function(e){u[c]=""+e},allowEmptyInput:h,hideCancelButton:d,submitText:p,cancelText:f,prefill:m}),{doNext:!0})}},s}),using("MO5.CoreObject","MO5.transform","MO5.easing","WSE.tools","WSE.tools::warn").define("WSE.DisplayObject",function(e,t,n,i,s){function r(){e.call(this)}return r.prototype=new e,r.prototype.flash=function(e,r){var o,a,u,c,l,d,h,p,f,m=i.getParsedAttribute;return r=r||{},o=this,u="yes"===m(e,"wait",this.interpreter)?!0:!1,a=+m(e,"duration",this.interpreter,500),p=+m(e,"opacity",this.interpreter,1),(d=r.element||document.getElementById(this.cssid))?(c=r.bus||this.bus,l=r.stage||this.stage,h=r.animation===!0?!0:!1,f=+d.style.opacity.replace(/[^0-9\.]/,"")>0?!0:!1,h||(o.interpreter.waitCounter+=1),t(function(e){d.style.opacity=e},f?p:0,f?0:p,{duration:a/3,easing:n.easeInCubic}).promise().then(function(){function e(e){d.style.opacity=e}function i(){h||(o.interpreter.waitCounter-=1)}var s;s={duration:a/3*2,easing:n.easeOutCubic},t(e,f?0:p,f?p:0,s).promise().then(i)}),{doNext:!0}):void s(this.bus,"DOM Element for asset is missing!",e)},r.prototype.flicker=function(e,i){var r,o,a,u,c,l,d,h,p,f,m,g,y,b,v;return i=i||{},r=this,o=e.getAttribute("duration")||500,c=e.getAttribute("times")||10,m=e.getAttribute("opacity")||1,d=i.element||document.getElementById(this.cssid),l=o/c,f=0,d?(parseInt(d.style.opacity,10)?(y=0,g=m,v=l/3,b=2*v):(g=0,y=m,b=l/3,v=2*b),a=i.bus||this.bus,u=i.stage||this.stage,h=i.animation===!0?!0:!1,h||(r.interpreter.waitCounter+=1),p=function(){f+=1,t(function(e){d.style.opacity=e},g,y,{duration:b,easing:n.easeInQuad}).promise().then(function(){t(function(e){d.style.opacity=e},y,g,{duration:v,easing:n.easeInQuad}).promise().then(function(){return c>=f?void setTimeout(p,0):void(h||(r.interpreter.waitCounter-=1))})})},p(),{doNext:!0}):void s(this.bus,"DOM Element for asset is missing!",e)},r.prototype.hide=function(e,s){var r,o,a,u,c,l,d,h,p,f,m,g,y,b,v,w,E,S,_=i.getParsedAttribute;if(s=s||{},r=this,a="yes"===_(e,"wait",this.interpreter)?!0:!1,o=_(e,"duration",this.interpreter,500),u=_(e,"effect",this.interpreter,"fade"),c=_(e,"direction",this.interpreter,"left"),g=s.animation===!0?!0:!1,y=document.getElementById(this.cssid),b=_(e,"easing",this.interpreter,"sineEaseOut"),v=null!==typeof n[b]?n[b]:n.sineEaseOut,w=this.stage,E=this.xUnit||"px",S=this.yUnit||"px","slide"===u){switch(y.style.opacity=1,"%"===E?(h=y.offsetLeft/(w.offsetWidth/100),l=100):(h=y.offsetLeft,l=w.offsetWidth),"%"===S?(p=y.offsetTop/(w.offsetHeight/100),d=100):(p=y.offsetTop,d=w.offsetHeight),c){case"left":f=h-l,m="left";break;case"right":f=h+l,m="left";break;case"top":f=p-d,m="top";break;case"bottom":f=p+d,m="top";break;default:f=h-l,m="left"}g||(r.interpreter.waitCounter+=1),function(){var e,n,i,s;e=function(e){y.style[m]=e+("left"===m?E:S)},n="left"===m?h:p,i=function(){switch(g||(r.interpreter.waitCounter-=1),y.style.opacity=0,c){case"left":case"right":y.style.left=h+E,m="left";break;case"top":case"bottom":y.style.top=p+S,m="top";break;default:y.style.left=h+E,m="left"}},s={duration:o,easing:v},t(e,n,f,s).promise().then(i)}()}else g||(r.interpreter.waitCounter+=1),function(){var e,n,i;e=function(e){y.style.opacity=e},i=function(){g||(r.interpreter.waitCounter-=1),y.style.opacity=0},n={duration:o,easing:v},t(e,1,0,n).promise().then(i)}();return{doNext:!0}},r.prototype.move=function(e,r){var o,a,u,c,l,d,h,p,f,m,g,y,b,v,w,E,S,_,A,k,T,x,O,W=this.interpreter;return r=r||{},l=this,c=document.getElementById(this.cssid),o=e.getAttribute("x"),a=e.getAttribute("y"),u=e.getAttribute("z"),A=e.getAttribute("xAnchor")||"0",k=e.getAttribute("yAnchor")||"0",null===A&&null!==this.xAnchor&&(A=this.xAnchor),null===k&&null!==this.yAnchor&&(k=this.yAnchor),o=i.replaceVariables(o,this.interpreter),a=i.replaceVariables(a,this.interpreter),u=i.replaceVariables(u,this.interpreter),A=i.replaceVariables(A,this.interpreter),k=i.replaceVariables(k,this.interpreter),f=i.getParsedAttribute(e,"duration",W,500),m=i.getParsedAttribute(e,"easing",W,"sineEaseOut"),g=null!==typeof n[m]?n[m]:n.sineEaseOut,w=r.animation===!0?!0:!1,_=this.interpreter.stage,T=c.offsetLeft,x=c.offsetTop,null!==o&&(h=i.extractUnit(o)||"px",o=parseInt(o,10)),null!==a&&(p=i.extractUnit(a)||"px",a=parseInt(a,10)),O=c.style.display,c.style.display="","%"===h&&(o=_.offsetWidth/100*o,h="px"),"%"===p&&(a=_.offsetHeight/100*a,p="px"),o=i.calculateValueWithAnchor(o,A,c.offsetWidth),a=i.calculateValueWithAnchor(a,k,c.offsetHeight),c.style.display=O,d="yes"===i.getParsedAttribute(e,"wait",W)?!0:!1,y=!1,b=!1,v=!1,null===o&&null===a&&null===u&&s(this.bus,"Can't apply command 'move' to asset '"+this.name+"' because no x, y or z position has been supplied.",e),null!==o&&(E="%"===h?T/(_.offsetWidth/100):T,w||(l.interpreter.waitCounter+=1),t(function(e){c.style.left=e+h},E,o,{duration:f,easing:g}).promise().then(function(){w||(l.interpreter.waitCounter-=1)})),null!==a&&(S="%"===p?x/(_.offsetHeight/100):x,w||(l.interpreter.waitCounter+=1),t(function(e){c.style.top=e+p},S,a,{duration:f,easing:g}).promise().then(function(){w||(l.interpreter.waitCounter-=1)})),null!==u&&(w||(l.interpreter.waitCounter+=1),t(function(e){c.style.zIndex=e},c.style.zIndex||0,parseInt(u,10),{duration:f,easing:g}).promise().then(function(){w||(l.interpreter.waitCounter-=1)})),this.bus.trigger("wse.assets.mixins.move",this),{doNext:!0}},r.prototype.shake=function(e,n){function s(e,t){for(var n=t/h;n>2;)n-=2;return n>1&&(n=2-n),n}var r,o,a,u,c,l,d,h,p,f,m,g;return n=n||{},u=this,a=document.getElementById(this.cssid),r=e.getAttribute("dx"),o=e.getAttribute("dy"),h=e.getAttribute("period")||50,d=e.getAttribute("duration")||275,p=n.animation===!0?!0:!1,g=this.interpreter.stage,null===r&&null===o&&(o="-10px"),null!==r&&(c=i.extractUnit(r),r=parseInt(r,10)),null!==o&&(l=i.extractUnit(o),o=parseInt(o,10)),null!==r&&(f="%"===c?a.offsetLeft/(g.offsetWidth/100):a.offsetLeft,u.interpreter.waitCounter+=1,t(function(e){a.style.left=e+c},f-r,f+r,{duration:d,easing:s}).then(function(){a.style.left=f+c,u.interpreter.waitCounter-=1})),null!==o&&(m="%"===l?a.offsetTop/(g.offsetHeight/100):a.offsetTop,u.interpreter.waitCounter+=1,t(function(e){a.style.top=e+l},m-o,m+o,{duration:d,easing:s}).promise().then(function(){a.style.top=m+l,u.interpreter.waitCounter-=1})),this.bus.trigger("wse.assets.mixins.shake",this),{doNext:!0}},r.prototype.show=function(e,r){var o,a,u,c,l,d,h,p,f,m,g,y,b,v,w,E,S,_,A,k,T,x=i.getParsedAttribute;if(r=r||{},o=this,u="yes"===x(e,"wait",this.interpreter)?!0:!1,a=x(e,"duration",this.interpreter,500),c=x(e,"effect",this.interpreter,"fade"),l=x(e,"direction",this.interpreter,"right"),b=r.element||document.getElementById(this.cssid),f=this.xUnit||"px",m=this.yUnit||"px",!b)return void s(this.bus,"DOM Element for asset is missing!",e);if(S=r.interpreter||this.interpreter,g=r.bus||this.bus,y=r.stage||this.stage,E=x(e,"easing",this.interpreter,"sineEaseOut"),w=null!==typeof n[E]?n[E]:n.sineEaseOut,v=r.animation===!0?!0:!1,"slide"===c){switch("%"===f?(d=b.offsetLeft/(y.offsetWidth/100),_=100):(d=b.offsetLeft,_=y.offsetWidth),"%"===m?(h=b.offsetTop/(y.offsetHeight/100),A=100):(h=b.offsetTop,A=y.offsetHeight),l){case"left":b.style.left=d+_+f,p="left";break;case"right":b.style.left=d-_+f,p="left";break;case"top":b.style.top=h+A+m,p="top";break;case"bottom":b.style.top=h-A+m,p="top";break;default:b.style.left=d-_+f,p="left"}b.style.opacity=1,v||(S.waitCounter+=1),k="%"===f?b.offsetLeft/(y.offsetWidth/100):b.offsetLeft,T="%"===m?b.offsetTop/(y.offsetHeight/100):b.offsetTop,t(function(e){b.style[p]=e+("left"===p?f:m)},"left"===p?k:T,"left"===p?d:h,{duration:a,easing:w}).promise().then(function(){v||(S.waitCounter-=1)})}else v||(S.waitCounter+=1),t(function(e){b.style.opacity=e},0,1,{duration:a,easing:w}).promise().then(function(){v||(S.waitCounter-=1)});return{doNext:!0}},r}),using("MO5.transform","MO5.easing","MO5.Animation","MO5.CoreObject","MO5.TimerWatcher","WSE.commands","WSE.tools::createTimer","WSE.tools::warn").define("WSE.assets.Animation",function(e,t,n,i,s,r,o,a){"use strict";function u(u,c){function l(t,n,i,s,r,o){return e(function(e){t.style[s]=e+r},n,i,o)}function d(e,t){var n,i;i=e,n=i.getAttribute("duration"),r["do"](i,c,{animation:!0}),null!==n&&t.addTimer(o(n))}function h(e,n){var i;i=n.length,b=y.length,v.cbs.push(function(){var r,o,a,u,c,h,p,f,m,g,y,w,E;for(E=new s,m=0;b>m;m+=1)if(u=e[m],"undefined"!=typeof u&&null!==u){h=u.getAttribute("asset");try{c=document.getElementById(v.assets[h].cssid)||v.stage}catch(S){continue}g=u.getAttribute("easing"),r=parseInt(u.getAttribute("from"),10),o=parseInt(u.getAttribute("to"),10),a=u.getAttribute("unit")||"",p=u.getAttribute("duration")||500,f=u.getAttribute("property"),y={},y.duration=p,null!==g&&"undefined"!=typeof t[g]&&null!==t[g]&&(y.easing=t[g]),E.addTimer(l(c,r,o,f,a,y))}for(w=0;i>w;w+=1)d(n[w],E);return E})}var p,f,m,g,y,b,v,w;if(i.call(this),this.stage=c.stage,this.bus=c.bus,this.asset=u,this.name=u.getAttribute("name"),this.cbs=[],this.assets=c.assets,this.isRunning=!1,v=this,p=this.asset.getElementsByTagName("group"),m=p.length,1>m)return a(this.bus,"Animation asset '"+this.name+"' is empty.",u),{doNext:!0};for(f=0;m>f;f+=1)g=p[f],y=g.getElementsByTagName("transform"),w=g.getElementsByTagName("do"),h(y,w);this.anim=new n,this.cbs.forEach(function(e){this.anim.addStep(e)}.bind(this)),this.bus.trigger("wse.assets.animation.constructor",this),function(){function e(){v.stop()}v.bus.subscribe(e,"wse.interpreter.restart"),v.bus.subscribe(e,"wse.interpreter.end"),v.bus.subscribe(e,"wse.interpreter.load.before")}()}return u.prototype=new i,u.prototype.start=function(){this.anim.start(),this.isRunning=!0,this.bus.trigger("wse.assets.animation.started",this)},u.prototype.stop=function(){this.anim.isRunning()&&this.anim.stop(),this.isRunning=!1,this.bus.trigger("wse.assets.animation.stopped",this)},u.prototype.save=function(){var e={assetType:"Animation",isRunning:this.isRunning,index:this.anim.index};return this.bus.trigger("wse.assets.animation.save",{subject:this,saves:e}),e},u.prototype.restore=function(e){this.isRunning=e.isRunning,this.isRunning===!0&&(this.anim.index=e.index,this.start()),this.bus.trigger("wse.assets.animation.restore",{subject:this,saves:e})},u}),using("MO5.CoreObject","WSE.tools::warn").define("WSE.assets.Audio",function(e,t){"use strict";function n(n,i){var s,r,o,a,u,c,l,d,h,p,f,m,g,y,b,v;if(e.call(this),b=i.bus,s=this,this.interpreter=i,this.bus=b,this.name=n.getAttribute("name"),this.tracks={},this.autopause="true"===n.getAttribute("autopause")?!0:!1,this.loop="true"===n.getAttribute("loop")?!0:!1,this.fade="true"===n.getAttribute("fade")?!0:!1,this.fadeinDuration=parseInt(n.getAttribute("fadein"))||1e3,this.fadeoutDuration=parseInt(n.getAttribute("fadeout"))||1e3,this._playing=!1,y=n.getElementsByTagName("track"),a=y.length,1>a)return t(this.bus,"No tracks defined for audio element '"+this.name+"'.",n),{doNext:!0};for(o=0;a>o;o+=1)if(l=y[o],h=l.getAttribute("title"),null!==h)if(r=l.getElementsByTagName("source"),c=r.length,1>c)t(this.bus,"No sources defined for track '"+h+"' in audio element '"+this.name+"'.",n);else{for(v={urls:[],autoplay:!1,loop:this.loop||!1,onload:this.bus.trigger.bind(this.bus,"wse.assets.loading.decrease")},p={},u=0;c>u;u+=1)g=r[u],f=g.getAttribute("href"),m=g.getAttribute("type"),null!==f?null!==m?(p[m]=f,v.urls.push(f)):t(this.bus,"No type defined for source in track '"+h+"' in audio element '"+this.name+"'.",n):t(this.bus,"No href defined for source in track '"+h+"' in audio element '"+this.name+"'.",n);this.bus.trigger("wse.assets.loading.increase"),d=new Howl(v),this.tracks[h]=d}else t(this.bus,"No title defined for track '"+h+"' in audio element '"+this.name+"'.",n);this.play=function(e){var t;return this._playing?{doNext:!0}:(this._playing=!0,this._paused=!1,e.getAttribute("fadein")?(this.interpreter.waitCounter+=1,t=+e.getAttribute("fadein"),this.tracks[this._currentTrack].volume(0),this.tracks[this._currentTrack].play(),this.tracks[this._currentTrack].fade(0,1,t,function(){this.interpreter.waitCounter-=1}.bind(this))):this.tracks[this._currentTrack].play(),{doNext:!0})},this.stop=function(e){var t;return this._currentTrack?(this._playing=!1,this._paused=!1,e&&e.getAttribute("fadeout")?(this.interpreter.waitCounter+=1,t=+e.getAttribute("fadeout"),this.tracks[this._currentTrack].fade(1,0,t,function(){this.tracks[this._currentTrack].stop(),this.interpreter.waitCounter-=1}.bind(this))):this.tracks[this._currentTrack].stop(),this.bus.trigger("wse.assets.audio.stop",this),{doNext:!0}):{doNext:!0}},this.pause=function(){return this._currentTrack&&this._playing?(this._paused=!0,this.tracks[this._currentTrack].pause(),{doNext:!0}):{doNext:!0}},this.bus.trigger("wse.assets.audio.constructor",this),this.bus.subscribe("wse.interpreter.restart",function(){this.stop()}.bind(this)),window.addEventListener("blur",function(){this._playing&&this.tracks[this._currentTrack].fade(1,0,200)}.bind(this)),window.addEventListener("focus",function(){this._playing&&this.tracks[this._currentTrack].fade(0,1,200)}.bind(this))}return n.prototype=new e,n.prototype.set=function(e){var t=!1;return this._playing&&(t=!0),this.stop(),this._currentTrack=e.getAttribute("track"),t&&this.play(e),{doNext:!0}},n.prototype.save=function(){var e={currentTrack:this._currentTrack,playing:this._playing,paused:this._paused};return this.bus.trigger("wse.assets.audio.save",this),e},n.prototype.restore=function(e){this._playing=e.playing,this._paused=e.paused,this._currentTrack=e.currentTrack,this._playing&&!this._paused&&this.tracks[this._currentTrack].play(),this.bus.trigger("wse.assets.audio.restore",this)},n}),using("MO5.CoreObject").define("WSE.assets.Character",function(e){"use strict";function t(t,n){e.call(this),this.asset=t,this.stage=n.stage,this.bus=n.bus,this.name=t.getAttribute("name"),this.bus.trigger("wse.assets.character.constructor",this)}return t.prototype=new e,t.prototype.setTextbox=function(e){this.asset.setAttribute("textbox",e.getAttribute("textbox")),this.bus.trigger("wse.assets.character.settextbox",this)},t.prototype.save=function(){var e={assetType:"Character",textboxName:this.asset.getAttribute("textbox")};return this.bus.trigger("wse.assets.character.save",{subject:this,saves:e}),e},t.prototype.restore=function(e){this.asset.setAttribute("textbox",e.textboxName),this.bus.trigger("wse.assets.character.restore",{subject:this,saves:e})},t}),using("WSE.DisplayObject","WSE.tools::applyAssetUnits","WSE.tools::warn").define("WSE.assets.Curtain",function(e,t,n){"use strict";function i(n,i){e.call(this),this.asset=n,this.interpreter=i,this.bus=i.bus,this.stage=i.stage,this.color=n.getAttribute("color")||"black",this.z=n.getAttribute("z")||2e4,this.cssid="WSECurtain_"+this.id,this.element=document.createElement("div"),this.name=n.getAttribute("name"),this.element.setAttribute("id",this.cssid),this.element.setAttribute("class","WSECurtain"),this.element.style.position="absolute",this.element.style.left=0,this.element.style.top=0,this.element.style.width=this.stage.offsetWidth+"px",this.element.style.height=this.stage.offsetHeight+"px",this.element.style.opacity=0,this.element.style.backgroundColor=this.color,this.element.style.zIndex=this.z,t(this,n),this.stage.appendChild(this.element)}return i.prototype=new e,i.prototype.set=function(e){this.color=e.getAttribute("color")||"black",this.element.style.backgroundColor=this.color},i.prototype.save=function(){return{color:this.color,cssid:this.cssid,z:this.z}},i.prototype.restore=function(e){this.color=e.color,this.cssid=e.cssid,this.z=e.z;try{this.element=document.getElementById(this.cssid)}catch(t){return void n(this.bus,"Element with CSS ID '"+this.cssid+"' could not be found.")}this.element.style.backgroundColor=this.color,this.element.style.zIndex=this.z},i}),using("MO5.transform","MO5.easing","WSE.DisplayObject","WSE.tools::applyAssetUnits","WSE.tools::attachEventListener","WSE.tools::extractUnit","WSE.tools::calculateValueWithAnchor","WSE.tools::warn").define("WSE.assets.Imagepack",function(e,t,n,i,s,r,o,a){"use strict";function u(e,t){var u,c,l,d,h,p,f,m,g,y,b,v,w,E,S,_,A;for(n.call(this),this.stage=t.stage,this.bus=t.bus,this.name=e.getAttribute("name"),this.cssid=e.getAttribute("cssid")||"wse_imagepack_"+this.name,this.interpreter=t,this.xAnchor=e.getAttribute("xAnchor"),this.yAnchor=e.getAttribute("yAnchor"),this.width=parseInt(e.getAttribute("width"),10)||100,this.height=parseInt(e.getAttribute("height"),10)||100,i(this,e),y=this,c={},u=document.createElement("div"),v=e.getAttribute("width"),w=e.getAttribute("height"),u.style.opacity=0,u.draggable=!1,u.setAttribute("class","imagepack"),u.setAttribute("id",this.cssid),u.setAttribute("data-wse-asset-name",this.name),l=e.getElementsByTagName("image"),b=y.bus.trigger.bind(y.bus,"wse.assets.loading.decrease",null,!1),d=0,h=l.length;h>d;d+=1)p=l[d],f=p.getAttribute("name"),m=p.getAttribute("src"),null!==f?null!==m?(g=new Image,this.bus.trigger("wse.assets.loading.increase",null,!1),s(g,"load",b),g.src=m,g.style.opacity=0,g.style.position="absolute",g.draggable=!1,g.setAttribute("data-wse-asset-image-name",f),null!==v&&g.setAttribute("width",v),null!==w&&g.setAttribute("height",w),c[f]=this.cssid+"_"+f,g.setAttribute("id",c[f]),u.appendChild(g)):a(this.bus,"Image without src in imagepack '"+this.name+"'.",e):a(this.bus,"Image without name in imagepack '"+this.name+"'.",e);u.style.position="absolute",u.style.zIndex=e.getAttribute("z")||0,this.stage.appendChild(u),E=parseInt(e.getAttribute("x")||0,10),S=parseInt(e.getAttribute("y")||0,10),_=r(e.getAttribute("x"))||"px",A=r(e.getAttribute("y"))||"px","%"===_&&(E=this.stage.offsetWidth/100*E),"%"===A&&(S=this.stage.offsetHeight/100*S),E=o(E,this.xAnchor,this.width),S=o(S,this.yAnchor,this.height),"%"===_&&(E/=this.stage.offsetWidth/100),"%"===A&&(S/=this.stage.offsetHeight/100),u.style.left=""+E+_,u.style.top=""+S+A,this.images=c,this.current=null}return u.prototype=new n,u.prototype.set=function(n,i){var s,r,o,u,c,l,d,h=this.bus;if(i=i||{},o=this,r=n.getAttribute("image"),c=n.getAttribute("duration")||400,l=i.animation===!0?!0:!1,null===r)return a(h,"Missing attribute 'image' on 'do' element referencing imagepack '"+this.name+"'.",n),{doNext:!0};try{s=document.getElementById(this.images[r])}catch(p){console.error("DOM Element for Image "+r+" on Imagepack "+this.name+" not found!",p)}if("undefined"==typeof s||null===s)return a(h,"Unknown image name on 'do' element referencing imagepack '"+this.name+"'.",n),{doNext:!0};u=this.current;for(var f in this.images)if(this.images.hasOwnProperty(f)){if(f!==r)continue;if(f===u)return a(h,"Trying to set the image that is already set on imagepack '"+this.name+"'.",n),{doNext:!0}}return l||(o.interpreter.waitCounter+=1),d=document.getElementById(this.cssid),d.style.width=s.offsetWidth+"px",d.style.height=s.offsetHeight+"px",function(){var n,i,r;n=function(e){s.style.opacity=e},i=function(){l||(o.interpreter.waitCounter-=1)},r={duration:c,easing:t.easeOutCubic},e(n,0,1,r).promise().then(i)}(),null!==this.current&&(l||(o.interpreter.waitCounter+=1),function(){var n;(n=function(){var n,i,s,r;n=document.getElementById(o.images[u]),i=function(e){n.style.opacity=e},s=function(){l||(o.interpreter.waitCounter-=1)},r={duration:c,easing:t.easeInCubic},e(i,1,0,r).promise().then(s)})()}()),this.current=r,{doNext:!0}},u.prototype.save=function(){var e,t,n,i,s;n=this.images,e=this.current||null,i=null;for(t in n)n.hasOwnProperty(t)&&n[t]===e&&(i=t);return s={assetType:"Imagepack",current:e,cssid:this.cssid,images:n,xAnchor:this.xAnchor,yAnchor:this.yAnchor,z:this.z},this.bus.trigger("wse.assets.imagepack.save",{subject:this,saves:s}),s},u.prototype.restore=function(e){var t;t=e.current,this.cssid=e.cssid,this.z=e.z,this.current=t,this.xAnchor=e.xAnchor,this.yAnchor=e.yAnchor,document.getElementById(this.cssid).style.zIndex=this.z,this.bus.trigger("wse.assets.imagepack.restore",{subject:this,saves:e})},u}),using("MO5.transform","MO5.dom.effects.typewriter","MO5.dom.Element","WSE.DisplayObject","WSE.tools::applyAssetUnits","WSE.tools::replaceVariables").define("WSE.assets.Textbox",function(e,t,n,i,s,r){"use strict";function o(e,t){i.call(this);var n,r,o,a,u,c,l,d;this.interpreter=t,this.name=e.getAttribute("name"),this.stage=t.stage,this.bus=t.bus,this.type=e.getAttribute("behaviour")||"adv",this.z=e.getAttribute("z")||5e3,this.showNames="yes"===e.getAttribute("namebox")?!0:!1,this.nltobr="true"===e.getAttribute("nltobr")?!0:!1,this.cssid="wse_textbox_"+this.name,this.effectType=e.getAttribute("effect")||"typewriter",this.speed=e.getAttribute("speed")||0,this.speed=parseInt(this.speed,10),this.fadeDuration=e.getAttribute("fadeDuration")||0,s(this,e),function(t){var n,i,s,r;try{for(r=e.childNodes,i=0,s=r.length;s>i;i+=1)if(1===r[i].nodeType&&"nameTemplate"===r[i].tagName){n=r[i];break}if(!n)throw new Error("No nameTemplate found.");t.nameTemplate=(new XMLSerializer).serializeToString(n)}catch(o){t.nameTemplate="{name}: "}}(this),"nvl"===this.type&&(this.showNames=!1),n=document.createElement("div"),r=document.createElement("div"),o=document.createElement("div"),n.setAttribute("class","textbox"),o.setAttribute("class","text"),r.setAttribute("class","name"),a=e.getAttribute("cssid")||this.cssid,n.setAttribute("id",a),this.cssid=a,u=e.getAttribute("x"),u&&(n.style.left=u),c=e.getAttribute("y"),c&&(n.style.top=c),n.style.zIndex=this.z,l=e.getAttribute("width"),d=e.getAttribute("height"),l&&(n.style.width=l),d&&(n.style.height=d),n.appendChild(r),n.appendChild(o),this.stage.appendChild(n),this.showNames===!1&&(r.style.display="none"),r.setAttribute("id",this.cssid+"_name"),o.setAttribute("id",this.cssid+"_text"),this.nameElement=this.cssid+"_name",this.textElement=this.cssid+"_text",n.style.opacity=0,this.bus.trigger("wse.assets.textbox.constructor",this)}return o.prototype=new i,o.prototype.put=function(i,s,o){function a(){"adv"===d.type&&(u.innerHTML=""),u.innerHTML+=l+i,c.innerHTML=d.nameTemplate.replace(/\{name\}/g,s)}var u,c,l,d,h,p="wse_no_character";return s=s||null,o=o||"_no_one",d=this,u=document.getElementById(this.textElement),c=document.getElementById(this.nameElement),h=n.fromDomElement(document.getElementById(this.cssid)),i=r(i,this.interpreter),d.interpreter.waitCounter+=1,l="",this.showNames===!1&&s&&(l=this.nameTemplate.replace(/\{name\}/g,s)),null===s?(this.showNames&&(c.style.display="none"),s=""):(this.showNames&&(c.style.display=""),p="wse_character_"+o.split(" ").join("_")),this._lastCssClass&&h.removeCssClass(this._lastCssClass),this._lastCssClass=p,h.addCssClass(p),this.speed<1&&(this.fadeDuration>0?(d.interpreter.waitCounter+=1,function(){var t,n,i;t=function(e){u.style.opacity=e},n=function(){d.interpreter.waitCounter-=1},i={duration:d.fadeDuration},e(t,1,0,i).promise().then(n)}()):a()),this.speed>0?("adv"===d.type&&(u.innerHTML=""),function(){var e;e=document.createElement("div"),e.setAttribute("class","line"),u.appendChild(e),e.innerHTML=l+i,c.innerHTML=d.nameTemplate.replace(/\{name\}/g,s),d.interpreter.waitCounter+=1,t(e,{speed:d.speed,onFinish:function(){d.interpreter.waitCounter-=1}})}()):this.fadeDuration>0&&(d.interpreter.waitCounter+=1,setTimeout(function(){a(),"nvl"===d.type&&(u.innerHTML="<div>"+u.innerHTML+"</div>"),e(function(e){u.style.opacity=e},0,1,{duration:d.fadeDuration,onFinish:function(){d.interpreter.waitCounter-=1}})},d.fadeDuration)),this.bus.trigger("wse.assets.textbox.put",this,!1),d.interpreter.waitCounter-=1,{doNext:!1}},o.prototype.clear=function(){return document.getElementById(this.textElement).innerHTML="",document.getElementById(this.nameElement).innerHTML="",this.bus.trigger("wse.assets.textbox.clear",this),{doNext:!0}},o.prototype.save=function(){return{assetType:"Textbox",type:this.type,showNames:this.showNames,nltobr:this.nltobr,cssid:this.cssid,nameElement:this.nameElement,textElement:this.textElement,z:this.z}},o.prototype.restore=function(e){this.type=e.type,this.showNames=e.showNames,this.nltobr=e.nltobr,this.cssid=e.cssid,this.nameElement=e.nameElement,this.textElement=e.textElement,this.z=e.z,document.getElementById(this.cssid).style.zIndex=this.z},o}),using("WSE.tools::applyAssetUnits","WSE.DisplayObject","WSE.tools::warn").define("WSE.assets.Background",function(e,t,n){"use strict";function i(e){e.element.setAttribute("width",e.stage.offsetWidth),e.element.setAttribute("height",e.stage.offsetHeight)}function s(e){var t=e.element.style;e.element.setAttribute("id",e.cssid),e.element.setAttribute("class","WSEBackground"),e.element.style.position="absolute",e.element.draggable=!1,t.left=0,t.top=0,t.opacity=0,t.zIndex=e.z}function r(r,o){t.call(this);var a=this;return this.asset=r,
this.interpreter=o,this.bus=o.bus,this.stage=o.stage,this.z=r.getAttribute("z")||10,this.cssid="WSEBackground_"+this.id,this.element=document.createElement("img"),this.src=r.getAttribute("src"),this.name=r.getAttribute("name"),this.src?(e(this,r),this.element.setAttribute("src",this.src),s(this),i(this),window.addEventListener("resize",function(){i(a)}),void this.stage.appendChild(this.element)):void n(this.bus,"No source defined on background asset.",r)}return r.prototype=new t,r.prototype.save=function(){return{cssid:this.cssid,z:this.z}},r.prototype.restore=function(e){this.cssid=e.cssid,this.z=e.z;try{this.element=document.getElementById(this.cssid)}catch(t){return void n(this.bus,"Element with CSS ID '"+this.cssid+"' could not be found.")}},r}),using("WSE.tools.ui","WSE.tools","WSE.tools::replaceVariables").define("WSE.commands.alert",function(e,t,n){function i(i,s){var r,o,a;return r=i.getAttribute("title")||"Alert!",o=i.getAttribute("message")||"Alert!",a="false"===n(i.getAttribute("next")||"",s)?!1:!0,o=n(o,s),r=n(r,s),o=t.textToHtml(o),s.bus.trigger("wse.interpreter.commands.alert",i),e.alert(s,{title:r,message:o,pause:!0,doNext:a}),{doNext:!0}}return i}),using().define("WSE.commands.break",function(){"use strict";function e(e,t){return t.bus.trigger("wse.interpreter.commands.break",{interpreter:t,command:e},!1),{doNext:!1,wait:!0}}return e}),using("WSE.tools","WSE.DisplayObject").define("WSE.commands.choice",function(e,t){"use strict";function n(n,i){var s,r,o,a,u,c,l,d,h,p,f,m,g,y;for(i.bus.trigger("wse.interpreter.commands.choice",{interpreter:i,command:n},!1),g=i.state,i.state="pause",r=[],h=[],p=i,o=n.childNodes,a=o.length,l=n.getAttribute("duration")||500,l=parseInt(l,10),y=n.getAttribute("cssid")||"WSEChoiceMenu",m=function(e,t,n,s){return n=n||null,function(r){r.stopPropagation(),r.preventDefault(),setTimeout(function(){var t=e.childNodes?e.childNodes.length:0,r=i.index,o=i.sceneId,a=i.scenePath.slice(),u=i.currentScene;null!==n&&p.changeSceneNoNext(n),t>0&&(i.pushToCallStack(),i.currentCommands=e.childNodes,i.sceneId=o,i.scenePath=a,i.scenePath.push(r-1),i.scenePath.push(s),i.index=0,i.currentScene=u,i.currentElement=0),p.next()},0),p.stage.removeChild(t),i.waitCounter-=1,i.state=g}},1>a&&i.bus.trigger("wse.interpreter.warning",{element:n,message:"Element 'choice' is empty. Expected at least one 'option' element."}),s=document.createElement("div"),s.setAttribute("class","menu"),s.setAttribute("id",y),s.setAttribute("data-wse-index",i.index),s.setAttribute("data-wse-scene-id",i.sceneId),s.setAttribute("data-wse-game",i.game.url),s.setAttribute("data-wse-type","choice"),u=0;a>u;u+=1)c=o[u],c.tagName&&"option"===c.tagName&&i.checkIfvar(c)&&(d=document.createElement("input"),d.setAttribute("class","button"),d.setAttribute("type","button"),d.setAttribute("tabindex",u+1),d.setAttribute("value",c.getAttribute("label")),d.value=e.replaceVariables(c.getAttribute("label"),i),f=c.getAttribute("scene")||null,h[u]=f?i.getSceneById(f):null,e.attachEventListener(d,"click",m(c,s,h[u],u)),r.push(d),s.appendChild(d));return s.style.opacity=0,i.stage.appendChild(s),t.prototype.show.call(void 0,n,{element:s,bus:i.bus,stage:i.stage,interpreter:i}),i.waitCounter+=1,{doNext:!1,wait:!0}}return n}),using("WSE.tools.ui").define("WSE.commands.confirm",function(e){return e.makeInputFn("confirm")}),using("WSE.tools::warn").define("WSE.commands.do",function(e){"use strict";function t(t,n,i){var s,r,o,a=n.bus,u=n.assets;return i=i||{},a.trigger("wse.interpreter.commands.do",{interpreter:n,command:t},!1),s=t.getAttribute("asset"),r=t.getAttribute("action"),o=i.animation||!1,null===s?void e(a,"Element of type 'do' must have an attribute 'asset'. Element ignored.",t):null===r?void e(a,"Element of type 'do' must have an attribute 'action'. Element ignored.",t):"undefined"==typeof u[s]||null===u[s]?(e(a,"Reference to unknown asset '"+s+"'.",t),{doNext:!0}):"undefined"==typeof u[s][r]?(e(a,"Action '"+r+"' is not defined for asset '"+s+"'.",t),{doNext:!0}):u[s][r](t,i)}return t}),using("WSE.functions","WSE.tools::warn").define("WSE.commands.fn",function(e,t){"use strict";function n(n,i){var s,r,o;return s=n.getAttribute("name")||null,r=n.getAttribute("tovar")||null,"function"!=typeof e[s]?(t(i.bus,"No name supplied on fn element.",n),{doNext:!0}):"function"!=typeof e[s]?(t(i.bus,"Unknown function '"+s+"'.",n),{doNext:!0}):(o=e[s](i),null!==r&&(i.runVars[r]=""+o),{doNext:!0})}return n}),using("WSE.tools::warn").define("WSE.commands.global",function(e){"use strict";function t(t,n){var i,s,r;return i=t.getAttribute("name")||null,s=t.getAttribute("value")||null,r={doNext:!0},null===i?(e(n.bus,"No name defined on element 'global'.",t),r):null===s?(e(n.bus,"No value defined on element 'global'.",t),r):(n.globalVars.set(i,s),r)}return t}),using("WSE.tools::warn").define("WSE.commands.globalize",function(e){"use strict";function t(t,n){var i,s;return i=t.getAttribute("name")||null,s={doNext:!0},null===i?(e(n.bus,"No variable name defined on globalize element.",t),s):"undefined"==typeof n.runVars[i]||null===n.runVars[i]?(e(n.bus,"Undefined local variable.",t),s):(n.globalVars.set(i,n.runVars[i]),s)}return t}),using("WSE.tools::replaceVariables","WSE.tools::logError").define("WSE.commands.goto",function(e,t){"use strict";function n(n,i){var s,r,o=i.bus;return o.trigger("wse.interpreter.commands.goto",{interpreter:i,command:n},!1),r=n.getAttribute("scene"),null===r&&t(o,"Element 'goto' misses attribute 'scene'."),r=e(r,i),s=i.getSceneById(r),null===s?void t(o,"Unknown scene '"+r+"'."):{changeScene:s}}return n}),using("WSE.tools::getSerializedNodes","WSE.tools::warn").define("WSE.commands.line",function(e,t){"use strict";function n(n,i){var s,r,o,a,u,c,l,d,h,p,f=i.bus;if(p={doNext:!0},f.trigger("wse.interpreter.commands.line",{interpreter:i,command:n},!1),s=n.getAttribute("s"),h="false"===n.getAttribute("stop")?!0:!1,null===s)return t(f,"Element 'line' requires attribute 's'.",n),p;for(l=i.story.getElementsByTagName("character"),u=l.length,a=0;u>a;a+=1)if(c=l[a],c.getAttribute("name")===s){if(o=c.getAttribute("textbox"),"undefined"==typeof o||null===o)return t(f,"No textbox defined for character '"+s+"'.",n),p;try{r=e(c.getElementsByTagName("displayname")[0])}catch(m){}break}return"undefined"==typeof i.assets[o]?(t(f,"Trying to use an unknown textbox or character.",n),p):(d=e(n),i.log.push({speaker:s,text:d}),i.assets[o].put(d,r,s),{doNext:h,wait:!0})}return n}),using("WSE.tools::warn").define("WSE.commands.localize",function(e){"use strict";function t(t,n){var i,s;return s={doNext:!0},i=t.getAttribute("name")||null,null===i?(e(n.bus,"No variable name defined on localize element.",t),s):n.globalVars.has(i)?(n.runVars[i]=n.globalVars.get(i),s):(e(n.bus,"Undefined global variable.",t),s)}return t}),using("WSE.tools.ui").define("WSE.commands.prompt",function(e){return e.makeInputFn("prompt")}),using().define("WSE.commands.restart",function(){"use strict";function e(e,t){for(t.bus.trigger("wse.interpreter.commands.restart",{interpreter:t,command:e},!1),t.bus.trigger("wse.interpreter.message","Restarting game...",!1),t.bus.trigger("wse.interpreter.restart",t,!1),t.runVars={},t.log=[],t.visitedScenes=[],t.startTime=Math.round(+new Date/1e3),t.waitCounter=0,t.state="listen",t.stage.innerHTML="",t.assets={},t.buildAssets();t.callStack.length>0;)t.callStack.shift();return{doNext:!0,changeScene:t.getFirstScene()}}return e}),using("WSE.tools::replaceVariables","WSE.commands.set_vars","WSE.tools::warn","WSE.tools::logError","WSE.tools::log").define("WSE.commands.sub",function(e,t,n,i,s){"use strict";function r(r,o){var a,u,c,l;return o.bus.trigger("wse.interpreter.commands.sub",{interpreter:o,command:r},!1),l={doNext:!0},a=r.getAttribute("scene")||null,c=r.getAttribute("next")===!1?!1:!0,null===a?(n(o.bus,"Missing 'scene' attribute on 'sub' command!",r),l):(a=e(a,o),(u=o.getSceneById(a))?(s(o.bus,"Entering sub scene '"+a+"'..."),o.pushToCallStack(),o.currentCommands=u.childNodes,o.index=-1,o.sceneId=a,o.scenePath=[],o.currentElement=-1,r.getAttribute("names")&&t(r,o),{doNext:c}):(i(o.bus,"No such scene '"+a+"'!",r),l))}return r}),using("WSE.tools::warn").define("WSE.commands.trigger",function(e){"use strict";function t(t,n){var i,s,r;return r={doNext:!0},n.bus.trigger("wse.interpreter.commands.trigger",{interpreter:n,command:t},!1),i=t.getAttribute("name")||null,s=t.getAttribute("action")||null,null===i?(e(n.bus,"No name specified on trigger command.",t),r):null===s?(e(n.bus,"No action specified on trigger command referencing trigger '"+i+"'.",t),r):"undefined"==typeof n.triggers[i]||null===n.triggers[i]?(e(n.bus,"Reference to unknown trigger '"+i+"'.",t),r):"function"!=typeof n.triggers[i][s]?(e(n.bus,"Unknown action '"+s+"' on trigger command referencing trigger '"+i+"'.",t),r):(n.triggers[i][s](t),r)}return t}),using("WSE.tools::replaceVariables","WSE.tools::warn","WSE.tools::log").define("WSE.commands.var",function(e,t,n){"use strict";function i(i,s){var r,o,a,u,c,l;if(l={doNext:!0},s.bus.trigger("wse.interpreter.commands.var",{interpreter:s,command:i},!1),r=i.getAttribute("name")||null,o=i.getAttribute("value")||"1",u=i.getAttribute("action")||"set",null===r)return t(s.bus,"Command 'var' must have a 'name' attribute.",i),l;if(c=s.runVars,"set"!==u&&!(r in c||i.getAttribute("lvalue")))return t(s.bus,"Undefined variable.",i),l;if(o=e(o,s),"set"===u)return c[r]=""+o,l;switch(a=i.getAttribute("lvalue")||c[r],a=e(a,s),u){case"delete":delete c[r];break;case"increase":c[r]=""+(parseFloat(a)+parseFloat(o));break;case"decrease":c[r]=""+(parseFloat(a)-parseFloat(o));break;case"multiply":c[r]=""+parseFloat(a)*parseFloat(o);break;case"divide":c[r]=""+parseFloat(a)/parseFloat(o);break;case"modulus":c[r]=""+parseFloat(a)%parseFloat(o);break;case"and":c[r]=""+(parseFloat(a)&&parseFloat(o));break;case"or":c[r]=""+(parseFloat(a)||parseFloat(o));break;case"not":c[r]=parseFloat(a)?"0":"1";break;case"is_greater":c[r]=parseFloat(a)>parseFloat(o)?"1":"0";break;case"is_less":c[r]=parseFloat(a)<parseFloat(o)?"1":"0";break;case"is_equal":c[r]=parseFloat(a)===parseFloat(o)?"1":"0";break;case"not_greater":c[r]=parseFloat(a)<=parseFloat(o)?"1":"0";break;case"not_less":c[r]=parseFloat(a)>=parseFloat(o)?"1":"0";break;case"not_equal":c[r]=parseFloat(a)!==parseFloat(o)?"1":"0";break;case"print":n(s.bus,"Variable '"+r+"' is: "+c[r]);break;default:t(s.bus,"Unknown action '"+u+"' defined on 'var' command.",i)}return l}return i}),using("WSE.tools::logError").define("WSE.commands.set_vars",function(e){"use strict";function t(t,n){var i,s,r,o=n.runVars;return r={doNext:!0},i=(t.getAttribute("names")||"").split(","),s=(t.getAttribute("values")||"").split(","),i.length!==s.length?(e(n.bus,"Number of names does not match number of values in <set_vars> command."),r):(i.forEach(function(e,t){o[e.trim()]=""+s[t].trim()}),r)}return t}),using().define("WSE.commands.wait",function(){"use strict";function e(e,t){var n,i;return t.bus.trigger("wse.interpreter.commands.wait",{interpreter:t,command:e},!1),i=t,n=e.getAttribute("duration"),null!==n?(n=parseInt(n,10),t.waitForTimer=!0,setTimeout(function(){i.waitForTimer=!1},n),{doNext:!0,wait:!1}):{doNext:!0,wait:!0}}return e}),using("WSE.tools::getParsedAttribute","WSE.tools::warn").define("WSE.commands.with",function(e,t){"use strict";function n(n,o){var u,c,l=o.runVars,d=n.childNodes,h=e(n,"var",o),p=d.length;for(u=0;p>u;u+=1)if(c=d[u],!i(c,o)&&(s(c)&&!a(c)&&t(o.bus,"Element 'when' without a condition. Ignored.",n),r(c)&&a(c)&&t(o.bus,"Element 'else' with a condition. Ignored.",n),r(c)||s(c)&&a(c)&&e(c,"is")===l[h])){o.pushToCallStack(),o.currentCommands=c.childNodes,o.scenePath.push(o.index),o.scenePath.push(u),o.index=-1,o.currentElement=-1;break}return{doNext:!0}}function i(e,t){return!e.tagName||!t.checkIfvar(e)||"when"!==e.tagName&&"else"!==e.tagName}function s(e){return o(e,"when")}function r(e){return o(e,"else")}function o(e,t){return e.tagName===t}function a(e){return e.hasAttribute("is")}return n}),using().define("WSE.commands.while",function(){"use strict";function e(e,t){return t.index-=1,t.currentElement-=1,t.pushToCallStack(),t.currentCommands=e.childNodes,t.scenePath.push(t.index+1),t.index=-1,t.currentElement=-1,{doNext:!0}}return e});